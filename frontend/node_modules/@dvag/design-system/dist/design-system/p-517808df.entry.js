import{r as t,c as i,h as e,H as s,g as o}from"./p-c66bef8d.js";import{v as n,E as r}from"./p-70f48e14.js";import{D as l}from"./p-54eaab21.js";import{o as h}from"./p-90458c1b.js";import{i as a}from"./p-7c3d7c10.js";import{I as c}from"./p-38e28938.js";import"./p-15b13381.js";class u{constructor(t,i){this.requestId=t,this.value=i}provideValues(t){this.internalValues=null==t?void 0:t.map(((t,i)=>Object.assign({id:`${i}`},t))),this.valuesProvided(this.requestId)}waitForValues(){return new Promise((t=>this.valuesProvided=t))}getValues(){return this.internalValues}}const p=class{constructor(e){t(this,e),this.search=i(this,"search",7),this.selectSearch=i(this,"selectSearch",7),this.valueChange=i(this,"valueChange",7),this.valueComplete=i(this,"valueComplete",7),this.searchDebounce=new l(500),this.categories=new Map,this.navigatableListItems=[],this.inputFocused=!1,this.internalValue="",this.waitForSearchValues=!1,this.popupopen=!1,this.value="",this.placeholder="Bitte eingeben ...",this.visibleentries=2.5,this.noresultstext="Ihre Suche ergab leider keine Treffer.",this.autoscrollintoview=!1}valueChanged(){this.obtainValueChangesFromOutside()}async focusControl(){this.inputElement.focus()}componentWillLoad(){n(this.self),this.obtainValueChangesFromOutside()}componentDidRender(){null!=this.selectedOption&&this.popupopen&&this.scrollIntoView(this.selectedOption)}disconnectedCallback(){this.searchDebounce.reset()}obtainValueChangesFromOutside(){this.value!==this.internalValue&&(this.internalValue=this.value,this.lastEmittedCompleteValue=this.value,this.selectedOption=this.createDummySelectedOptionWithCurrentValue())}createDummySelectedOptionWithCurrentValue(){var t;return(null===(t=this.value)||void 0===t?void 0:t.length)>0?{id:null,label:this.value,prelabel:null,sublabel:null,category:null,data:null}:null}onInputFocused(){this.popupopen=!0,this.inputFocused=!0,this.emitSearchEvent()}onInputBlurred(){h((()=>{this.waitForSearchValues=!1,this.popupopen=!1,this.emitValueChange(),this.emitValueComplete(),this.inputFocused&&(this.inputFocused=!1,this.selectSearchValue(this.selectedOption))}))}clearInput(){this.inputElement.value="",this.internalValue="",this.selectedOption=null,this.searchValues=null,this.popupopen=!1,this.selectSearch.emit(null),this.emitValueChange()}blurInput(){var t;this.inputFocused=!1,null===(t=this.inputElement)||void 0===t||t.blur()}getCurrentSearchValue(){var t,i,e;return this.popupopen?null!==(i=null===(t=this.searchValues)||void 0===t?void 0:t.find((t=>t.label.toLowerCase()===this.internalValue.toLowerCase())))&&void 0!==i?i:null===(e=this.searchValues)||void 0===e?void 0:e[0]:null}onInputKeyUp(t){if(this.handleUpAndDownNavigation(t));else if(["Enter","Escape"].includes(t.key)){if("Enter".includes(t.key)){const t=this.getCurrentSearchValue();if(null==t)return this.clearInput(),void this.blurInput();this.selectedOption=t,this.selectSearchValue(this.selectedOption)}"Escape".includes(t.code)&&this.popupopen&&(this.popupopen=!1)}}handleUpAndDownNavigation(t){var i;if(["ArrowDown","ArrowUp"].includes(t.code)){if((null===(i=this.navigatableListItems)||void 0===i?void 0:i.length)>0&&this.popupopen)return this.selectEntryWithArrowDownOrUp(t.code),t.preventDefault(),t.stopImmediatePropagation(),!0;if(""===this.internalValue)return;this.popupopen||(this.emitSearchEvent(),this.popupopen=!0)}return!1}selectEntryWithArrowDownOrUp(t){let i=this.navigatableListItems.findIndex((t=>{var i;if(d(t))return t.id===(null===(i=this.selectedOption)||void 0===i?void 0:i.id)}));"ArrowDown"===t?-1===i||i===this.navigatableListItems.length-1?this.selectOption(this.navigatableListItems.find((t=>d(t)))):(i++,d(this.navigatableListItems[i])||i++,this.selectOption(this.navigatableListItems[i])):"ArrowUp"===t&&(i<=0?this.selectOption(this.navigatableListItems[this.navigatableListItems.length-1]):(i--,i<=0&&(i=this.navigatableListItems.length-1),d(this.navigatableListItems[i])||i--,i>0&&this.selectOption(this.navigatableListItems[i])))}selectOption(t){this.selectedOption=t,this.internalValue=this.selectedOption.label,this.emitValueChange(),this.scrollIntoView(this.selectedOption)}selectSearchValue(t){null!=t&&(this.selectedOption=t,this.internalValue=t.label,this.searchValues=null,this.selectSearch.emit(t),this.popupopen=!1,this.blurInput())}scrollIntoView(t){var i,e,s;if(this.popupopen){const o=this.navigatableListItems.findIndex((i=>i.id===(null==t?void 0:t.id)));if(o>-1){const t=this.self.shadowRoot.querySelector(".autocomplete-popup"),n=Array.from(this.self.shadowRoot.querySelectorAll(".autocomplete-item")),r=null!==(i=null==t?void 0:t.offsetHeight)&&void 0!==i?i:0,l=null!==(s=null===(e=n[0])||void 0===e?void 0:e.offsetHeight)&&void 0!==s?s:0;t.scrollTop=l*o-r/2+l/2}}}onInputInput(){var t;this.internalValue=this.inputElement.value,(null===(t=this.internalValue)||void 0===t?void 0:t.length)>0?(this.popupopen=!0,this.emitValueChange()):(this.popupopen=!1,this.searchValues=null),this.searchDebounce.run((()=>{this.emitSearchEvent()}))}emitSearchEvent(){this.waitForSearchValues=!0;const t=m++,i=new u(t,this.internalValue);i.waitForValues().then((t=>{this.lastSearchId===t&&(this.searchValues=i.getValues(),this.extractCategories(),this.waitForSearchValues=!1,this.autoscrollintoview&&this.searchValues.length>0&&h((()=>h((()=>this.inputElement.scrollIntoView({block:"start",behavior:"smooth"}))))))})),this.lastSearchId=t,this.search.emit(i)}extractCategories(){this.categories.clear(),this.navigatableListItems=[],null!=this.searchValues&&(this.populateCategoriesFromSearchResults(),this.fillNavigatableListFromCategories())}populateCategoriesFromSearchResults(){this.searchValues.forEach((t=>{var i,e;null==t.category||""==t.category?this.categories.set(null,[...null!==(i=this.categories.get(null))&&void 0!==i?i:[],t]):this.categories.set(t.category,[...null!==(e=this.categories.get(t.category))&&void 0!==e?e:[],t])}))}fillNavigatableListFromCategories(){Array.from(this.categories.keys()).map((t=>{this.navigatableListItems.push({label:t}),this.categories.get(t).forEach((t=>{this.navigatableListItems.push(t)}))}))}emitValueComplete(){this.lastEmittedCompleteValue!==this.internalValue&&(this.valueComplete.emit(this.internalValue),this.value=this.internalValue,this.lastEmittedCompleteValue=this.internalValue)}emitValueChange(){this.lastEmittedChangeValue!==this.internalValue&&(this.lastEmittedChangeValue=this.internalValue,this.value=this.internalValue,this.valueChange.emit(this.internalValue))}render(){return e(s,null,this.renderInput())}renderInput(){const t=this.visibleentries*f;return e("dx-overlay",{position:"bottom",offsety:4,disabled:!this.popupopen},e(c,{active:this.inputFocused,title:this.value},e("ds-icon",{icon:"suchen",size:24}),e("input",{id:r.createId(this.self,"control"),ref:t=>this.inputElement=t,onInput:()=>this.onInputInput(),onKeyUp:t=>this.onInputKeyUp(t),onFocus:()=>this.onInputFocused(),onBlur:()=>this.onInputBlurred(),type:"text",placeholder:this.placeholder,value:this.internalValue}),this.renderClearButton()),this.renderAutocompleteValues(t))}renderClearButton(){const t=""!==this.internalValue&&this.inputFocused;return e("ds-function-icon-button",{id:r.createId(this.self,"clear-button"),unfocusable:!0,class:{"clear-button":!0,visible:t},onPointerDown:()=>this.clearInput()},e("ds-icon",{icon:"schliessen-input",size:16}))}renderAutocompleteValues(t){if(this.popupopen)return e("div",{class:"autocomplete-container",slot:"overlay"},e("div",{class:"autocomplete-popup",style:{"--ds-search-popup-height":`${t}px`}},this.renderPopupContent()))}renderPopupContent(){return this.waitForSearchValues?this.renderWaitingSpinner():null!=this.searchValues?0===this.searchValues.length?this.renderEmptySearchResults():this.renderCategories():void 0}renderCategories(){return Array.from(this.categories.keys()).map((t=>e("div",{class:"category-container"},this.renderCategoryHeadline(t),e("div",null,Array.from(this.categories.get(t)).map((t=>{var i,s;return e("div",{class:{"autocomplete-item":!0,selected:(null==t?void 0:t.label)==(null===(i=this.selectedOption)||void 0===i?void 0:i.label)&&t.category==(null===(s=this.selectedOption)||void 0===s?void 0:s.category)},onPointerDown:()=>{a()||this.selectSearchValue(t)},onClick:()=>{a()&&this.selectSearchValue(t)}},this.renderAutoCompleteItem(t))}))))))}renderCategoryHeadline(t){if(null!=t&&""!=t)return e("div",{class:"category-headline-container"},e("ds-text",{class:"category-headline",type:"ftf"},t))}renderWaitingSpinner(){return e("div",{class:"wait-for-search-results"},e("ds-spinner",{size:"medium"}))}renderEmptySearchResults(){return e("div",{class:"no-hits"},e("ds-text",{type:"it"},this.noresultstext))}renderAutoCompleteItem(t){const i=(t,i)=>(null==t?void 0:t.length)>0?e("ds-text",{type:i},t):null;return e("ds-column",null,[i(t.prelabel,"itk"),i(t.label),i(t.sublabel,"itk")])}get self(){return o(this)}static get watchers(){return{value:["valueChanged"]}}};function d(t){return null!=t&&"id"in t&&"label"in t}let m=0;const f=76;p.style=':host{display:block}:host:host([hidden]){display:none !important}:host .container{position:relative;top:0;left:0;display:flex;height:38px;border-radius:4px;border:1px solid #c1c1c1;background-color:#ffffff;box-sizing:border-box;align-items:center}:host .container.required-outline{border-color:#e8b50e}:host .container.requirement-fulfilled{border-color:#c1c1c1}:host .container.red-outline{border-color:#be1413}:host .container.disabled-outline{border-color:#ebebeb}:host .container.active{border-color:#4c4c4c}:host .container ds-icon{padding-left:11px;cursor:pointer}:host .container input{height:22px;margin:8px 0 8px 8px;border:none;outline:none;font-family:"Helvetica Neue", "Helvetica Neue LT W01";font-size:16px;line-height:24px;letter-spacing:0.02px;color:#4c4c4c;width:1px;flex-grow:1}:host .container input::placeholder{color:#c1c1c1}:host .container input:disabled{background-color:#ffffff;color:#c1c1c1}:host .container .clear-button{visibility:hidden}:host .container .clear-button.visible{visibility:visible}:host .autocomplete-container{box-shadow:0 4px 12px 0 rgba(0, 0, 0, 0.32);border-radius:4px}:host .autocomplete-container .autocomplete-popup{width:100%;max-height:var(--ds-search-popup-height, 190px);background-color:#ffffff;overflow-y:scroll}:host .autocomplete-container .autocomplete-popup .wait-for-search-results{display:flex;justify-content:center;align-items:center;padding:16px 0 16px 0;height:64px}:host .autocomplete-container .autocomplete-popup .no-hits{display:flex;justify-content:center;align-items:center;text-align:center;padding:16px;min-height:64px}:host .autocomplete-container .autocomplete-popup .category-container .category-headline-container{border-bottom:1px solid #dedede;padding:16px;user-select:none}:host .autocomplete-container .autocomplete-popup .category-container .category-headline-container .category-headline{word-break:break-all;color:#7f7f7f}:host .autocomplete-container .autocomplete-popup .autocomplete-item{position:relative;user-select:none;-webkit-user-select:none;text-align:left;display:flex;flex-direction:column;justify-content:center;align-items:flex-start;box-sizing:border-box;padding:16px;color:#666666}:host .autocomplete-container .autocomplete-popup .autocomplete-item.selected{background-color:#f5f5f5}:host .autocomplete-container .autocomplete-popup .autocomplete-item:not(:last-child):after{border-bottom:1px solid #dedede;content:"";width:calc(100% - 16px);position:absolute;bottom:0px}:host .autocomplete-container .autocomplete-popup .autocomplete-item:hover{background-color:#f5f5f5;cursor:pointer}';export{p as ds_search}