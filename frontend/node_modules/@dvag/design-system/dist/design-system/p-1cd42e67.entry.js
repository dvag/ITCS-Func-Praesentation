import{r as t,c as i,f as s,h as e,H as n,g as o}from"./p-c66bef8d.js";import{S as l}from"./p-968cb048.js";import{D as r}from"./p-54eaab21.js";import{s as h,c as a}from"./p-aa0a06c6.js";import{a as d}from"./p-dc250dcd.js";import{E as c}from"./p-70f48e14.js";import"./p-fabbcf47.js";import"./p-15b13381.js";const u=class{constructor(s){t(this,s),this.tableStateChanged=i(this,"tableStateChanged",7),this.rowsSelected=i(this,"rowsSelected",7),this.currentSortSettings={column:null,reverse:!1},this.sortDebounce=new r(50),this.rowDebounce=new r(200),this.touchMoveDetected=!1,this.scrollHintFadedOutHandler=()=>{this.scrollHintNecessary=this.showScrollHint},this.scrollHandler=()=>{this.controlOpticalHints()},this.currentPage=1,this.selectedRowKeys=[],this.showScrollHint=!0,this.scrollHintNecessary=!1,this.internalScrollable=!1,this.view="default",this.pagesizes="[25,50,100]",this.pagesize=25,this.initialsortdirection="asc",this.mode="managed",this.selectionenabled=!1,this.selectionmode="multi",this.rowcount=0,this.initialized=!1}onSideBarOpenChange(){this.selectionenabled?this.getRows().every((t=>null==t.rowid))&&(console.warn("To use table selection you have to define at least one <ds-table-row> with a valid 'rowid'!\n",this.self),this.selectionenabled=!1):(this.selectedRowKeys=[],null!=this.selectionGroup?(this.selectionGroup.value=null,this.rowsSelected.emit(null)):this.rowsSelected.emit([])),this.controlOpticalHints()}onScrollableChange(){var t;this.setScrollable(),this.controlOpticalHints(),null===(t=this.headerItemElements)||void 0===t||t.forEach((t=>{t.usemaxwidth=this.internalScrollable}))}onTouchStart(){this.touchMoveDetected=!1}onTouchmove(){this.touchMoveDetected=!0}onTouchEnd(t){this.touchMoveDetected&&(t.stopImmediatePropagation(),this.touchMoveDetected=!1)}connectedCallback(){this.initialized=!1,this.observeHeaderItems(),this.observeRows(),this.setScrollable()}initResizeObserver(){this.tableResizeObserver=new ResizeObserver((t=>{this.updateTableScroll(t[0].contentRect.width),this.controlOpticalHints()}))}setScrollable(){var t;this.scrollable?this.initResizeObserver():(null===(t=this.tableResizeObserver)||void 0===t||t.disconnect(),this.tableResizeObserver=null,this.internalScrollable=this.scrollable,this.updateCellSettings().then())}updateTableScroll(t){if(null==this.headerItemElements||0===this.headerItemElements.length)return;const i=this.headerItemElements.reduce(((t,i)=>{var s;const e=parseInt(null===(s=i.minwidth)||void 0===s?void 0:s.toString());return isNaN(e)&&console.error("ds-table:",this.self,"Every <ds-table-header-item> in a scrollable table has to set a minwidth. At least one <ds-table-header-item> was not given a size."),t+i.minwidth+16}),0)+16>t;this.internalScrollable!==i&&(this.internalScrollable=i,this.updateCellSettings().then(),i||(this.showLeftGradient=!1,this.showRightGradient=!1))}hideScrollHint(){this.showScrollHint=!1}controlOpticalHints(){if(!this.internalScrollable||null==this.scrollContainer)return;const t=this.scrollContainer.scrollLeft,i=this.scrollContainer.scrollWidth-this.scrollContainer.clientWidth;requestAnimationFrame((()=>{const s=t>0;this.showRightGradient=t<i,this.showLeftGradient=this.isScrollingPossible()&&this.selectionenabled,this.calculateShouldHideScrollHint(s)}))}isScrollingPossible(){var t,i;return this.internalScrollable&&(null===(t=this.scrollContainer)||void 0===t?void 0:t.scrollWidth)>(null===(i=this.scrollContainer)||void 0===i?void 0:i.clientWidth)}calculateScrollHintNecessary(){this.scrollHintNecessary=this.isScrollingPossible()}calculateShouldHideScrollHint(t){t&&this.showScrollHint&&this.hideScrollHint()}disconnectedCallback(){var t,i,s;null===(t=this.headerItemObserver)||void 0===t||t.disconnect(),null===(i=this.rowObserver)||void 0===i||i.disconnect(),this.rowDebounce.reset(),this.sortDebounce.reset(),null===(s=this.tableResizeObserver)||void 0===s||s.disconnect()}async invokeSort(t,i){if(this.initialized)return this.internalInvokeSort(t,i);this.invokeSortInputParamsBeforeInit={element:t,reverse:i}}async internalInvokeSort(t,i){var s;const e=this.headerItemElements.indexOf(t);this.headerItemElements.forEach(((t,i)=>{e!==i&&t.setSortDirection("neutral")})),this.sortState={column:null!==(s=t.columnid)&&void 0!==s?s:t.label,index:e,direction:i?"desc":"asc"},this.sortRows({column:e,reverse:i})}reSort(){null!==this.currentSortSettings.column&&this.sortRows(this.currentSortSettings)}isViewUsingPagination(){return this.view.includes("paginated")}observeRows(){this.rowObserver=new l(this.self,"ds-table-row",(()=>{this.rowDebounce.run((async()=>{this.rowObserver.disconnect(),await this.updateCellSettings();const t=this.getRows();this.checkForDuplicateRowKeys(t),this.handleRemoteSelection(t),h(t,this.rowElements)?s(this.self):(this.rowElements=t,"managed"===this.mode&&(this.rowcount=t.length,b(this.headerItemElements)?this.reSort():this.manipulateDOMRows(this.rowElements)),this.updateVisibility()),this.rowObserver.connect(),this.init()}))}))}handleRemoteSelection(t){requestAnimationFrame((()=>{var i;if("single"===this.selectionmode){const s=this.selectedRowKeys[0],e=null===(i=t.filter((t=>1==t.selected)).filter((t=>t.rowid!==s))[0])||void 0===i?void 0:i.rowid;if(null==e)return;this.selectionenabled=!0,this.handleRadioSelection(e)}else t.forEach((t=>{this.selectionenabled||(this.selectionenabled=t.selected),this.handleCheckboxSelection(t.rowid,t.selected)}))}))}init(){this.initialized=!0,null!=this.invokeSortInputParamsBeforeInit&&(this.internalInvokeSort(this.invokeSortInputParamsBeforeInit.element,this.invokeSortInputParamsBeforeInit.reverse).then(),this.invokeSortInputParamsBeforeInit=null)}updateVisibility(){if("managed"===this.mode&&this.isViewUsingPagination()){const t=this.getRows(),i=this.getCurrentRowsRangeIndices();t.forEach(((t,s)=>{t.setAttribute("visible",""+(s>=i.fromIndex&&s<=i.toIndex))}))}this.updateAlternatingRowHighlights()}getCurrentRowsRangeIndices(){var t,i;const s=(null!==(t=this.pagesize)&&void 0!==t?t:0)*(this.currentPage-1),e={fromIndex:s,toIndex:s};return e.toIndex+="managed"===this.mode?(null!==(i=this.pagesize)&&void 0!==i?i:this.rowcount)-1:this.pagesize-1,e.toIndex=Math.min(this.rowcount-1,e.toIndex),e}updateAlternatingRowHighlights(){this.getRows().forEach(((t,i)=>{t.classList.remove("odd"),i%this.pagesize%2==0&&t.classList.add("odd")}))}emitTableStateChanged(){const t=this.getCurrentRowsRangeIndices();this.tableStateChanged.emit({page:this.currentPage,pageSize:this.pagesize,fromIndex:t.fromIndex,toIndex:t.toIndex,sortState:this.sortState})}observeHeaderItems(){this.headerItemObserver=new l(this.self,"ds-table-header-item",(async t=>{var i,s;const e=await Promise.all(t.map((t=>t.toColumnSettings())));if(!this.differentSettings(e)&&a(this.headerItemElements,t))return;this.settings=e;const n=b(this.headerItemElements);if(this.headerItemElements=t,!n){const e=await(null==t?void 0:t.filter((t=>t.sortable)));let n=null;(null===(i=this.initialsort)||void 0===i?void 0:i.length)>0&&(n=null==e?void 0:e.find((t=>t.columnid===this.initialsort||t.label===this.initialsort)),d(null!=n,(()=>`Kein <ds-header-item-element> mit der 'columnid' oder dem 'label' "${this.initialsort}" gefunden`))),null!=n||(n=null==e?void 0:e[0]),null==n||n.setSortDirection(null!==(s=this.initialsortdirection)&&void 0!==s?s:"asc")}this.updateCellSettings().then()}))}differentSettings(t){return null==this.settings||null!=t.find(((t,i)=>{return!((null==(s=t)?void 0:s.type)===(null==(e=this.settings[i])?void 0:e.type)&&(null==s?void 0:s.align)===(null==e?void 0:e.align)&&(null==s?void 0:s.lines)===(null==e?void 0:e.lines)&&JSON.stringify(null==s?void 0:s.sizeStyle)==JSON.stringify(null==e?void 0:e.sizeStyle));var s,e}))}async updateCellSettings(){var t;return null===(t=this.headerItemElements)||void 0===t||t.forEach((t=>{t.usemaxwidth=this.internalScrollable})),Promise.all(this.getRows().concat(this.getFooters()).flatMap((t=>Array.from(t.querySelectorAll("ds-table-cell")).map(((t,i)=>{var s;return i<(null===(s=this.headerItemElements)||void 0===s?void 0:s.length)?t.obtainSettings(this.settings[i]):null})).filter((t=>null!=t)))))}getRows(){return Array.from(this.self.querySelectorAll("ds-table-row"))}getFooters(){return Array.from(this.self.querySelectorAll("ds-table-footer"))}compareColumns(t,i,s,e){var n;const o="ds-table-cell:nth-child("+(s+1)+")";if("html"===e){const e=this.headerItemElements[s];return null!=e.customSort?e.customSort(t.querySelector(o),i.querySelector(o)):0}const l=t.querySelector(o).getAttribute("value"),r=i.querySelector(o).getAttribute("value");return"numeric"===e||"currency"===e?parseFloat(l)-parseFloat(r):null!==(n=null==l?void 0:l.localeCompare(r))&&void 0!==n?n:r?-1:0}sortRows(t){var i,s;((i=this.currentSortSettings).column!==(s=t).column||i.reverse!==s.reverse)&&(this.currentPage=1,this.emitTableStateChanged()),"remote"!==this.mode&&(this.currentSortSettings.column=t.column,this.currentSortSettings.reverse=t.reverse,this.sortDebounce.run((()=>{var i,s;const e=[...null!==(i=this.getRows())&&void 0!==i?i:[]],n=null===(s=this.settings[t.column])||void 0===s?void 0:s.type,o=t.reverse?-1:1,l=this.headerItemElements.filter(((i,s)=>s!==t.column)).filter((t=>t.sortable&&null!=t.sortpriority)).sort(((t,i)=>i.sortpriority-t.sortpriority)).map((t=>this.headerItemElements.indexOf(t)));e.sort(((i,s)=>{var e;let r=t.column,h=n;const a=[...l];let d=this.compareColumns(i,s,r,h)*o;for(;0===d&&a.length>0;)r=a.pop(),h=null===(e=this.settings[r])||void 0===e?void 0:e.type,d=this.compareColumns(i,s,r,h);return d})),this.manipulateDOMRows(e),this.updateVisibility()})))}checkForDuplicateRowKeys(t){const i=t.reduce(((t,i)=>{var s,e;return null!=i.rowid&&(t[i.rowid]=null!==(e=null===(s=t[i.rowid])||void 0===s?void 0:s.concat(i))&&void 0!==e?e:[i]),t}),{});Object.keys(i).forEach((t=>{const s=i[t];s.length>1&&console.error(`Duplicate key "${t}" in rows:\n`,...s)}))}manipulateDOMRows(t){let i=null;this.self.querySelectorAll(":scope > *").forEach((t=>{["ds-table-row","ds-table-footer"].includes(t.tagName.toLowerCase())||(i=t)})),[...t].reverse().forEach((t=>{i.insertAdjacentElement("afterend",t)}))}handlePaginationPageSizeChanged(t){this.pagesize=t.detail,this.emitTableStateChanged(),this.updateVisibility()}handlePaginationPageChanged(t){const i=t.detail;this.currentPage!==i&&(this.currentPage=i,this.emitTableStateChanged(),this.updateVisibility())}handleRadioSelection(t){this.selectedRowKeys[0]!==t&&(this.selectedRowKeys=[t],this.rowElements.forEach((t=>{t.selected=t.rowid==this.selectedRowKeys[0]})),this.rowsSelected.emit([...this.selectedRowKeys]))}handleCheckboxSelection(t,i){const s=this.rowElements.filter((i=>i.rowid===t))[0];i&&!this.selectedRowKeys.includes(t)?(s.selected=!0,this.selectedRowKeys.push(t)):i||(s.selected=!1,this.selectedRowKeys=this.selectedRowKeys.filter((i=>i!==t))),this.rowsSelected.emit([...this.selectedRowKeys])}componentDidRender(){var t,i;if(this.calculateScrollHintNecessary(),this.controlOpticalHints(),"multi"===this.selectionmode){const s=this.self.querySelectorAll("ds-table-row.visible"),e=null===(i=null===(t=this.self)||void 0===t?void 0:t.shadowRoot)||void 0===i?void 0:i.querySelectorAll(".row");null==e||e.forEach(((t,i)=>{if(null==t.firstElementChild)return;const e=t.querySelector("ds-checkbox");null!=e&&(e.checked=this.selectedRowKeys.includes(s[i].rowid))}))}else this.selectionGroup.value=this.selectedRowKeys[0]}render(){return"default"===this.view?this.renderDefault():"paginated-card"===this.view?this.renderPaginatedCard(!1):"paginated-card-shadow"===this.view?this.renderPaginatedCard(!0):void 0}renderSelectionGroup(){let t=this.getRows();if("managed"===this.mode){const i=this.getCurrentRowsRangeIndices();t=t.slice(i.fromIndex,i.toIndex+1)}return"single"===this.selectionmode?this.renderRadioSelection(t):this.renderCheckboxSelection(t)}renderCheckboxSelection(t){return e("div",null,t.map(((t,i)=>e("div",{class:{row:!0,odd:i%2==0},style:{height:t.offsetHeight<40?"40px":t.offsetHeight+"px"}},t.rowid?e("ds-checkbox",{id:c.createId(this.self,`selection-button-${i}`),checked:this.selectedRowKeys.includes(t.rowid),onCheckedChange:i=>this.handleCheckboxSelection(t.rowid,i.detail)}):null))))}renderRadioSelection(t){return e("ds-radio-button-group",{id:c.createId(this.self,"selection-group"),ref:t=>this.selectionGroup=t,onValueChange:t=>this.handleRadioSelection(t.detail)},t.map(((t,i)=>e("div",{class:{row:!0,odd:i%2==0},style:{height:t.offsetHeight<40?"40px":t.offsetHeight+"px"}},t.rowid?e("ds-radio-button",{id:c.createId(this.self,`selection-button-${i}`),value:t.rowid}):null))))}renderSidebarFooter(){return this.getFooters().map((t=>e("div",{style:{height:t.offsetHeight-4+"px"},class:{footer:!0}})))}getScrollWidth(){return this.headerItemElements.reduce(((t,i)=>{var s;return t+parseInt(null===(s=i.maxwidth||i.minwidth)||void 0===s?void 0:s.toString())+16}),0)+16}renderSidebar(){var t,i;return e("div",{class:{"sidebar-container":!0,open:this.selectionenabled}},e("div",{class:"sidebar"},e("div",{class:"header",style:{height:(null===(i=null===(t=this.headerItemElements)||void 0===t?void 0:t[0])||void 0===i?void 0:i.offsetHeight)+"px"}}),[this.renderSelectionGroup(),this.renderSidebarFooter()]))}setScrollContainer(t){var i,s;this.scrollContainer!==t&&(null===(i=this.scrollContainer)||void 0===i||i.removeEventListener("scroll",this.scrollHandler),this.scrollContainer=t,null===(s=this.scrollContainer)||void 0===s||s.addEventListener("scroll",this.scrollHandler))}renderScrollableTableContent(){return e("div",null,this.renderScrollHint(),e("ds-scroll-container",{scrollbarmargin:8},e("div",{ref:t=>{this.setScrollContainer(t)},class:{scrollable:!0},style:{"--ds-table-row-width":this.internalScrollable?`${this.getScrollWidth()}px`:"none"}},e("slot",null))))}renderScrollHint(){return this.scrollHintNecessary?e("div",{class:{"scroll-hint":!0,show:this.showScrollHint},onTransitionEnd:()=>this.scrollHintFadedOutHandler()},e("ds-icon",{icon:"listenpfeil",color:"weiss",size:32})):""}renderTable(){return[this.renderSidebar(),e("div",{class:"table",style:{"--ds-row-border-left-radius":this.selectionenabled?"0px":"6px"},ref:t=>{var i;null===(i=this.tableResizeObserver)||void 0===i||i.observe(t)}},this.internalScrollable?this.renderScrollableTableContent():e("slot",null),e("div",{class:{"left-gradient":!0,"show-gradient":this.showLeftGradient},style:{left:`${this.self.scrollLeft}`}}," "),e("div",{class:{"right-gradient":!0,"show-gradient":this.showRightGradient}}," "))]}renderDefault(){return e(n,{role:"table"},this.renderTable())}renderPaginatedCard(t){return e(n,{role:"table",class:{paginated:!0,"paginated-shadow":t}},e("ds-card",null,e("ds-card-header",null,e("div",null,e("slot",{name:"title"})),e("ds-table-page-size-picker",{value:this.pagesize,pagesizes:this.pagesizes,onPageSizeChanged:t=>this.handlePaginationPageSizeChanged(t)})),e("ds-card-content",null,e("div",{class:"card-content-bottom-margin"},this.renderTable())),e("ds-hr",null),e("div",{class:"footer"},e("ds-paginator",{id:c.createId(this.self,"paginator"),onPageChanged:t=>this.handlePaginationPageChanged(t),range:1,current:this.currentPage,count:Math.ceil(this.rowcount/this.pagesize)}))))}get self(){return o(this)}static get watchers(){return{selectionenabled:["onSideBarOpenChange"],scrollable:["onScrollableChange"]}}};function b(t){return null==t?void 0:t.some((t=>t.sortable))}u.style="@keyframes slide-left{0%{transform:translateX(0)}100%{transform:translateX(-10px)}}:host{display:flex;width:100%}:host:host([hidden]){display:none !important}:host .card-content-bottom-margin{display:flex;width:100%;margin-bottom:8px}:host ds-card{width:100%}:host .table{display:flex;width:100%;overflow:hidden;flex-direction:column;position:relative}:host .table .scroll-hint{display:var(--display-for-backstop-tests, flex);position:absolute;right:20px;bottom:calc(50% - (48px / 2));border-radius:6px;z-index:2;transition:opacity ease-in-out 1s;opacity:0;width:48px;height:48px;background-color:#666666;animation:slide-left 0.75s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite alternate both;justify-content:center;align-items:center}:host .table .scroll-hint.show{opacity:0.6}:host .table .left-gradient{transition:width 300ms ease-in-out;z-index:1;height:calc(100% - 8px);position:absolute;background:radial-gradient(at left center, #c1c1c1, transparent 80%);pointer-events:none;top:0;width:0}:host .table .left-gradient.show-gradient{width:15px}:host .table .right-gradient{transition:width 300ms ease-in-out;width:0;height:100%;z-index:1;position:absolute;right:0px;background:linear-gradient(270deg, white, rgba(255, 255, 255, 0));top:0px;pointer-events:none}:host .table .right-gradient.show-gradient{width:25px}:host .table .scrollable{position:relative;overflow-x:auto;margin-bottom:8px;min-width:100%}:host .table .scrollable::-webkit-scrollbar{display:none}:host ds-scroll-container.table{overflow:visible}:host .footer{display:flex;justify-content:flex-end;padding:12px 24px}:host .footer ds-paginator{width:350px}:host:host(.paginated){border-radius:6px}:host:host(.paginated-shadow){box-shadow:0 4px 12px 0 rgba(0, 0, 0, 0.16)}.sidebar-container{display:flex;flex-direction:row-reverse;position:relative;transition:transform 300ms ease-in-out, flex 300ms ease-in-out;will-change:flex;flex:0 0 0;height:max-content;overflow:hidden;border-bottom-left-radius:6px;border-top-left-radius:6px;z-index:2}.sidebar-container.open{flex:0 0 40px;transition:transform 300ms ease-in-out, flex 300ms ease-in-out}.sidebar-container.open .sidebar .row{border-radius:6px 0 0 6px;align-items:center}.sidebar-container .sidebar{flex:0 0 40px}.sidebar-container .sidebar .row{display:flex;justify-content:center;border-radius:6px 0 0 6px;box-sizing:border-box;align-items:center}.sidebar-container .sidebar .row.odd{background-color:#f5f5f5}.sidebar-container .sidebar .row.selected{background-color:#dedede}.sidebar-container .sidebar .footer{margin-top:4px;border-bottom-left-radius:6px;border-top-left-radius:6px;background-color:#e2ecd0}";export{u as ds_table}