import{r as t,c as s,h as i,H as n,g as h}from"./p-c66bef8d.js";import{P as e,t as o}from"./p-e0194d22.js";import{k as r,c as l,f as a}from"./p-aa0a06c6.js";import{S as d}from"./p-968cb048.js";import"./p-fabbcf47.js";const g=class{constructor(i){t(this,i),this.sort=s(this,"sort",7),this.automaticScrollIntervalHandler=null,this.autoScrollActive=!1,this.currentDraggingSortItem=null,this.sortable=!0,this.dragging=!1}onSortableChanged(){this.sortItems.forEach((t=>{t.internaldraggable=this.sortable}))}getNearestItem(t){return this.sortItems.reduce(((s,i)=>{const n=i.getBoundingClientRect(),h=t.y-n.top-n.height;return h<0&&h>s.offset?{offset:h,element:i}:s}),{offset:Number.NEGATIVE_INFINITY,element:null}).element}stopAutomaticScrolling(){clearInterval(this.automaticScrollIntervalHandler),setTimeout((()=>{this.autoScrollActive=!1}),200)}automaticScroll(t,s,i){clearInterval(this.automaticScrollIntervalHandler);let n=.1*i;this.automaticScrollIntervalHandler=setInterval((()=>{n=Math.max(1,n+.01),"down"===t?this.contentDiv.scrollTop=this.contentDiv.scrollTop+n:"up"===t&&(this.contentDiv.scrollTop=this.contentDiv.scrollTop-n),this.updateSlotsOrder(new e(0,s))}),0),this.autoScrollActive=!0}onMouseWheel(t){this.dragging&&(this.contentDiv.scrollTop=this.contentDiv.scrollTop+t.deltaY,this.updateSlotsOrder(o(t)))}onDraggingStart(t){this.dragging=!0,this.currentDraggingSortItem=t.target}onDragging(t){this.dragging=!0,this.autoScrollActive||this.updateSlotsOrder(t.detail),this.updateAutomaticScrolling(t)}onDraggingEnd(){this.dragging=!1,this.stopAutomaticScrolling(),this.currentDraggingSortItem=null;const t=t=>t.value,s=[...this.sortItems],i=[...this.sortItems].sort(((t,s)=>parseFloat(t.slot)-parseFloat(s.slot)));this.sort.emit({originalArray:s.map(t),sortedArray:i.map(t)})}connectedCallback(){setTimeout((()=>{this.contentDiv=r(this.self)}),500),this.slotObserver=new d(this.self,"dx-sort-item",(t=>{this.dragging||l(this.sortItems,t)||(t.forEach(((t,s)=>{t.slot=s.toString(),t.internaldraggable=this.sortable})),this.sortItems=t)}))}disconnectedCallback(){var t;null===(t=this.slotObserver)||void 0===t||t.disconnect()}updateAutomaticScrolling(t){const s=this.contentDiv.getBoundingClientRect().y+32,i=this.contentDiv.offsetHeight+this.contentDiv.getBoundingClientRect().y-32,n=t.detail.y<s,h=t.detail.y>i;n||h?n&&(()=>0===this.contentDiv.scrollTop)()||h&&(()=>this.contentDiv.scrollHeight-this.contentDiv.scrollTop===this.contentDiv.clientHeight)()?this.stopAutomaticScrolling():n?this.automaticScroll("up",t.detail.y,s-t.detail.y):this.automaticScroll("down",t.detail.y,t.detail.y-i):this.stopAutomaticScrolling()}pushAwaySortItems(t){const s=parseFloat(this.currentDraggingSortItem.slot);this.sortItems.filter((t=>t!==this.currentDraggingSortItem)).forEach((i=>{const n=parseFloat(i.slot);n>s&&n<=t?i.slot=(n-1).toString():n<s&&n>=t&&(i.slot=(n+1).toString())})),this.currentDraggingSortItem.slot=t.toString();const i={};this.sortItems.forEach((t=>{i[t.slot]&&console.error(t.slot,"is already filled",i[t.slot]),i[t.slot]||(i[t.slot]=[]),i[t.slot].push(t)}))}updateSlotsOrder(t){const s=this.getNearestItem(t);if(null!=s){const t=parseFloat(s.slot);this.pushAwaySortItems(t)}}render(){var t,s;return i(n,null,null!==(s=null===(t=this.sortItems)||void 0===t?void 0:t.map(((t,s)=>i("slot",{name:s.toString()}))))&&void 0!==s?s:i("slot",null))}get self(){return h(this)}static get watchers(){return{sortable:["onSortableChanged"]}}};g.style=":host{display:block;position:relative}:host:host([hidden]){display:none !important}";const u=class{constructor(i){t(this,i),this.dragging=s(this,"dragging",7),this.draggingStart=s(this,"draggingStart",7),this.draggingEnd=s(this,"draggingEnd",7)}onDragElementChanged(){var t;null===(t=this.draggableElements)||void 0===t||t.forEach((t=>{t.internaldragging=null!=this.dragElement}))}onSortableChange(){var t;null===(t=this.draggableElements)||void 0===t||t.forEach((t=>{t.internaldraggable=this.internaldraggable}))}connectedCallback(){this.slotObserver=new d(this.self,"*",(t=>{this.draggableElements=t.filter((t=>{return"internaldraggable"in(s=t)&&"internaldragging"in s;var s})),this.draggableElements.forEach((t=>{t.internaldraggable=this.internaldraggable,t.internaldragging=null!=this.dragElement}))}))}disconnectedCallback(){var t;null===(t=this.slotObserver)||void 0===t||t.disconnect()}onDragBegan(t){var s,i;if(this.isCurrentlyDragging())return;this.draggingStart.emit(),this.dragElement=this.self.shadowRoot.querySelector(".slot-container"),this.draggableElements.forEach((t=>t.internaldragging=!0)),this.dragElementRect=this.dragElement.getBoundingClientRect();const n=this.self.getBoundingClientRect(),h=null!==(i=null===(s=a(this.self,(t=>"none"!==getComputedStyle(t).transform)))||void 0===s?void 0:s.getBoundingClientRect())&&void 0!==i?i:{x:0,y:0},r=new e(2);this.startDragOffset=o(n).minus(t.detail).minus(h).minus(r),this.updateDragElementPosition(t.detail)}onDragFinished(){this.isCurrentlyDragging()&&(this.dragElement.style.transform="translate3d(0,0,0)",this.dragElement=null,this.draggableElements.forEach((t=>t.internaldragging=!1)),this.dragElementRect=null,this.startDragOffset=null,this.draggingEnd.emit())}onWindowMouseMove(t){this.isCurrentlyDragging()&&this.updateDragElementPosition(t.detail)}isCurrentlyDragging(){return this.internaldraggable&&null!=this.dragElement}updateDragElementPosition(t){this.dragElement.style.setProperty("transform",`translate3d(${t.x+this.startDragOffset.x}px, ${t.y+this.startDragOffset.y}px, 0)`),this.dragging.emit(t.copy())}renderPlaceholder(){var t;if(this.isCurrentlyDragging())return i("div",{style:{width:`${this.dragElementRect.width}px`,height:`${null===(t=this.dragElementRect)||void 0===t?void 0:t.height}px`}})}renderSlot(t,s){return i("div",{class:{"slot-container":!0},style:{width:null==t||isNaN(t)?"100%":`${t}px`,height:null==s||isNaN(s)?"unset":`${s}px`}},i("slot",null))}renderContent(){var t,s;return this.internaldraggable?[this.renderSlot(null===(t=this.dragElementRect)||void 0===t?void 0:t.width,null===(s=this.dragElementRect)||void 0===s?void 0:s.height),this.renderPlaceholder()]:this.renderSlot()}render(){return i(n,{class:{dragging:this.isCurrentlyDragging()}},this.renderContent())}get self(){return h(this)}static get watchers(){return{dragElement:["onDragElementChanged"],internaldraggable:["onSortableChange"]}}};u.style=":host{display:block;user-select:none}:host:host([hidden]){display:none !important}:host:host(.dragging){background-color:#f7f7f7}:host:host(.dragging) .slot-container{position:fixed;top:0;left:0;z-index:1020;background:#ffffff}:host .slot-container{position:relative}";export{g as dx_sort,u as dx_sort_item}