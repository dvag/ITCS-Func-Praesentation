import{r as t,c as i,h as e,H as s,g as o}from"./p-c66bef8d.js";import{v as l,E as h}from"./p-70f48e14.js";import{R as n}from"./p-4de2e84c.js";import{i as r}from"./p-7c3d7c10.js";import{I as a}from"./p-38e28938.js";import{E as u}from"./p-3f966ea5.js";import{o as c}from"./p-90458c1b.js";import"./p-15b13381.js";function d(t,i){if((null==t?void 0:t.length)>0){let e=0,s="",o=0;if((null==i?void 0:i.length)>0)for(const l of t.split(""))if(f.includes(l)){if(i.length===e)break;const t=i[e++];if(l===b&&!m.test(t))return s.substring(0,o);s+=t,o=s.length}else s+=l,o=s.length;return s}return i}function p(t,i){return(null==t?void 0:t.length)>0?t.split("").map(((t,e)=>{var s;return f.includes(t)&&null!==(s=i[e])&&void 0!==s?s:""})).join(""):i}const b="0",f=["X",b],m=/\d/,v=class{constructor(e){t(this,e),this.valueChange=i(this,"valueChange",7),this.valueComplete=i(this,"valueComplete",7),this.autocomplete=i(this,"autocomplete",7),this.selectAutocomplete=i(this,"selectAutocomplete",7),this.preventAutocomplete=!1,this.inputFocused=!1,this.internalValue="",this.currentFocusedIndex=0,this.kisynced=!1,this.error=!1,this.value="",this.placeholder="Bitte eingeben ...",this.disabled=!1,this.readonly=!1,this.required=!1}valueChanged(){this.obtainValueChangesFromOutside()}async focusControl(){this.inputElement.focus()}componentWillLoad(){l(this.self),this.obtainValueChangesFromOutside(!0)}obtainValueChangesFromOutside(t=!1){const i=d(this.mask,this.value);(t||this.value!==this.internalValue&&i!==this.internalValue)&&(this.internalValue=i,this.lastEmittedChangeValue=this.value,this.lastEmittedCompleteValue=this.value,this.emitAutocompleteEvent())}onInputFocused(){this.inputFocused=!0,this.emitAutocompleteEvent()}onInputBlurred(){this.inputFocused=!1,this.autocompleteValues=null,this.emitValueChange(),this.emitValueComplete()}clearInput(){this.inputElement.value="",this.internalValue="",this.emitValueChange()}onInputKeyDown(t){!this.shouldShowAutocompleteValues()||"ArrowUp"!==t.key&&"ArrowDown"!==t.key||t.preventDefault()}shouldShowAutocompleteValues(){var t;const i=(null===(t=this.autocompleteValues)||void 0===t?void 0:t.length)>0;return this.inputFocused&&i}onInputKeyUp(t){var i,e,s,o;"Enter"==t.key&&((null===(i=this.autocompleteValues)||void 0===i?void 0:i.length)>0&&this.selectAutocompleteValue(this.autocompleteValues[this.currentFocusedIndex]),this.inputElement.blur()),(null===(e=this.mask)||void 0===e?void 0:e.length)>0&&(null===(s=t.key)||void 0===s?void 0:s.includes("Arrow"))&&this.moveTextCursorToEnd(),(null===(o=this.autocompleteValues)||void 0===o?void 0:o.length)>0&&this.updateCurrentFocusedIndexAndScrollIntoView(t)}updateCurrentFocusedIndexAndScrollIntoView(t){"ArrowDown"===t.key?(this.currentFocusedIndex=(this.currentFocusedIndex+1)%this.autocompleteValues.length,this.scrollIntoView(this.currentFocusedIndex)):"ArrowUp"===t.key&&(this.currentFocusedIndex=(this.currentFocusedIndex+this.autocompleteValues.length-1)%this.autocompleteValues.length,this.scrollIntoView(this.currentFocusedIndex))}scrollIntoView(t){c((()=>{if(t>-1){const i=this.self.shadowRoot.querySelector(".autocomplete-popup");if(null==i)return;const e=Array.from(this.self.shadowRoot.querySelectorAll(".autocomplete-item"))[0].offsetHeight;i.scrollTop=e*t-i.offsetHeight/2+e/2}}))}onInputClicked(){var t;(null===(t=this.mask)||void 0===t?void 0:t.length)>0&&this.moveTextCursorToEnd()}moveTextCursorToEnd(){this.inputElement.setSelectionRange(this.internalValue.length,this.internalValue.length)}onInputInput(t){var i;(null===(i=this.mask)||void 0===i?void 0:i.length)>0?this.handleMaskedInput(t):this.internalValue=this.inputElement.value,this.emitAutocompleteEvent(),this.emitValueChange()}selectAutocompleteValue(t){this.internalValue=t.value,this.autocompleteValues=null,this.emitValueChange(),this.selectAutocomplete.emit(t.data)}emitAutocompleteEvent(){this.preventAutocomplete||this.autocomplete.emit({value:p(this.mask,this.internalValue),provideValues:t=>{this.autocompleteValues=t,this.currentFocusedIndex=0}})}emitValueChange(){const t=p(this.mask,this.internalValue);this.lastEmittedChangeValue!==t&&(this.value=t,this.valueChange.emit(this.value),this.lastEmittedChangeValue=this.value)}emitValueComplete(){this.lastEmittedCompleteValue!==this.value&&(this.valueComplete.emit(this.value),this.lastEmittedCompleteValue=this.value)}handleMaskedInput(t){const i=this.internalValue,e=this.inputElement.value,s=t.data;let o;if("insertFromPaste"===t.inputType)o=e.length===this.mask.length?e:d(this.mask,e);else if(i.length<e.length){const t=p(this.mask,null==s?e:i)+(null!=s?s:"");o=d(this.mask,t)}else if("deleteContentBackward"===t.inputType){let t=p(this.mask,i);t=t.substring(0,t.length-1),o=d(this.mask,t)}else o=d(this.mask,p(this.mask,e));this.inputElement.value=o,this.internalValue=o,this.moveTextCursorToEnd()}render(){return this.readonly?e(n,{text:this.value,label:this.label,kisynced:this.kisynced}):e(s,null,this.renderInput())}renderInput(){var t,i,s,o;const l=(null===(t=this.errormessage)||void 0===t?void 0:t.length)>0||this.error;return e("label",null,e("ds-input-label",{disabled:this.disabled,kisynced:this.kisynced,label:this.label}),e("dx-overlay",{position:"bottom",offsety:4,disabled:!this.shouldShowAutocompleteValues()},e(a,{active:this.inputFocused,error:l,required:this.required,requirementFulfilled:(null===(i=this.value)||void 0===i?void 0:i.length)>0,disabled:this.disabled,title:this.value},e("input",{id:h.createId(this.self,"control"),ref:t=>this.inputElement=t,onInput:t=>this.onInputInput(t),onKeyUp:t=>this.onInputKeyUp(t),onKeyDown:t=>this.onInputKeyDown(t),onFocus:()=>this.onInputFocused(),onBlur:()=>this.onInputBlurred(),onClick:()=>this.onInputClicked(),type:"text",placeholder:this.placeholder,value:this.internalValue,maxLength:(null===(s=this.mask)||void 0===s?void 0:s.length)||this.limitlength,disabled:this.disabled}),this.renderClearButton(),e(u,{text:this.errormessage,show:this.inputFocused})),this.renderAutocompleteValues()),e("ds-required-hint",{required:this.required,fulfilled:(null===(o=this.value)||void 0===o?void 0:o.length)>0}))}renderAutocompleteValues(){if(this.shouldShowAutocompleteValues())return e("div",{slot:"overlay",class:"autocomplete-popup"},this.autocompleteValues.map(((t,i)=>e("div",{onPointerDown:()=>{r()||this.selectAutocompleteValue(t)},onClick:()=>{r()&&(this.selectAutocompleteValue(t),this.preventAutocomplete=!0,setTimeout((()=>this.preventAutocomplete=!1),200))},class:{"autocomplete-item":!0,active:this.currentFocusedIndex===i}},e("ds-text",null,t.label)))))}renderClearButton(){const t=""!==this.internalValue&&this.inputFocused;return e("ds-function-icon-button",{id:h.createId(this.self,"clear-button"),unfocusable:!0,class:{"clear-button":!0,visible:t},onPointerDown:()=>this.clearInput()},e("ds-icon",{icon:"schliessen-input",size:16}))}get self(){return o(this)}static get watchers(){return{value:["valueChanged"]}}};v.style=':host{display:block}:host:host([hidden]){display:none !important}:host:host([label]:not([label=""])){--ds-info-button-offset-y:24px}:host label{display:block}:host label .container{position:relative;top:0;left:0;display:flex;height:38px;border-radius:4px;border:1px solid #c1c1c1;background-color:#ffffff;box-sizing:border-box;align-items:center}:host label .container.required-outline{border-color:#e8b50e}:host label .container.requirement-fulfilled{border-color:#c1c1c1}:host label .container.red-outline{border-color:#be1413}:host label .container.disabled-outline{border-color:#ebebeb}:host label .container.active{border-color:#4c4c4c}:host label .container input{height:22px;margin:8px 0 8px 8px;border:none;outline:none;font-family:"Helvetica Neue", "Helvetica Neue LT W01";font-size:16px;line-height:24px;letter-spacing:0.02px;color:#4c4c4c;width:1px;flex-grow:1}:host label .container input::placeholder{color:#c1c1c1}:host label .container input:disabled{background-color:#ffffff;color:#c1c1c1}:host label .container .clear-button{visibility:hidden}:host label .container .clear-button.visible{visibility:visible}:host label .autocomplete-popup{min-width:max-content;max-height:215px;border-radius:4px;box-shadow:0 4px 12px 0 rgba(0, 0, 0, 0.32);background-color:#ffffff;overflow-y:auto}:host label .autocomplete-popup .autocomplete-item{user-select:none;-webkit-user-select:none;padding:0 10px;text-align:left;height:39px;display:flex;align-items:center;box-sizing:border-box;border-bottom:1px solid #dedede}:host label .autocomplete-popup .autocomplete-item:hover{background-color:#f5f5f5;cursor:pointer}:host label .autocomplete-popup .autocomplete-item.active{background-color:#ebebeb}:host label .autocomplete-popup .autocomplete-item:last-child{border-bottom:none}';export{v as ds_text_input}