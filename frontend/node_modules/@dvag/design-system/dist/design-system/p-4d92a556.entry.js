import{r as t,c as i,h as e,H as s,g as n}from"./p-c66bef8d.js";import{E as r}from"./p-70f48e14.js";import{o}from"./p-90458c1b.js";import{a as h}from"./p-aa0a06c6.js";import{I as l}from"./p-38e28938.js";import{R as u}from"./p-4de2e84c.js";import{E as c}from"./p-3f966ea5.js";import"./p-15b13381.js";function a(t){return null==t?null:parseInt(`${t.prefix?"1":"0"}${t.focusNext?"1":"0"}`,10)}function d(t){if(null==t)return null;const i=t.toString().padStart(2,"0"),e=t=>"1"===t;return{prefix:e(i[0]),focusNext:e(i[1])}}class p{constructor(){this.pattern=""}}class f{}const v=/[#§]/,b=/[^§#]+/;class x{constructor(t){this.inputGroup=t,this.inputElement=null,this.lastValue=""}setInputElement(t){this.inputElement!==t&&(this.inputElement=t)}getInputGroup(){return this.inputGroup}getInputElement(){return this.inputElement}getInputValue(){var t;return null===(t=this.inputElement)||void 0===t?void 0:t.value}extractCharacters(t,i){const e=this.inputElement.value.substring(0,t);return this.inputElement.value=this.inputElement.value.slice(t),this.onDeleteEvent(this,i),e}appendExtractedToValue(t,i){this.inputElement.value+=t;const e="deleteContentBackward"==i?this.caretPosition-1:this.caretPosition;this.inputElement.selectionStart=e,this.inputElement.selectionEnd=e,this.caretPosition=e}clearInput(){this.inputElement.value="",this.lastValue="",this.recomputeTextInputWidth()}checkIsFulfilled(){var t;return(null===(t=this.inputElement)||void 0===t?void 0:t.value.length)==this.inputGroup.pattern.length}focus(){this.inputElement.focus()}focusAndSetCaretPosition(t,i){this.inputElement.focus(),this.inputElement.selectionStart=t,this.inputElement.selectionEnd=i}saveCurrentValue(){this.lastValue=this.inputElement.value}resetToLastValue(){this.inputElement.value=this.lastValue}checkPreventInput(t){if("§"===this.inputGroup.pattern[0]){if(!t.data[0].match(/[a-zA-Z\W_]/))return!0}else if(!t.data[0].match(/\d/))return!0;return!1}onInput(t){t.preventDefault(),t.isTrusted||(this.shouldPrefixValue(t)?this.inputElement.value=t.data+this.inputElement.value:this.inputElement.value+=t.data);const i=d(Number(t.detail));this.handleDeleteEvent(t);const e=this.handlePaste(t,i.focusNext);this.handleOverflow(e,t.isTrusted,i.focusNext),null!=t.data&&this.checkPreventInput(t)?this.resetToLastValue():(this.saveCurrentValue(),this.recomputeTextInputWidth(),this.onValueChanged())}handleOverflow(t,i,e=!0){const s=i?this.inputElement.selectionStart-1:null,n=t.length>0,r=this.getInputValue();if(n||r.length>=this.inputGroup.width+1)if(n)this.inputInNextGroupedInput(t,!0,!0,e,0);else{const t=r.slice(-1);this.inputElement.value=this.inputElement.value.slice(0,this.inputGroup.width),null!=s&&(this.inputElement.selectionStart=s+1,this.inputElement.selectionEnd=s+1),this.inputInNextGroupedInput(t,!1,!0,this.inputGroup.width==s,1)}}handlePaste(t,i=!0){if("insertFromPaste"===t.inputType){const t=this.getInputValue(),e=t.substring(0,this.inputGroup.width);return this.acceptPasteOrReset(e,i),t.substring(this.inputGroup.width,t.length)}return""}handleDeleteEvent(t){if(this.isDeleteEvent(t)){const i=this.getInputValue();this.onDeleteEvent(this,t.inputType),null!=i&&0!=i.length||(this.saveCurrentValue(),this.focusPrevController()),this.recomputeTextInputWidth(),this.caretPosition=this.inputElement.selectionStart}}shouldPrefixValue(t){return d(Number(t.detail)).prefix}acceptPasteOrReset(t,i=!0){this.checkPattern(t)?(this.inputElement.value=t,i&&this.inputElement.focus()):this.resetToLastValue()}isDeleteEvent(t){return"deleteContentBackward"===t.inputType||"deleteContentForward"===t.inputType}handleKeyDown(t){"Backspace"===t.code&&(this.saveCurrentValue(),0==this.inputElement.selectionStart&&this.focusPrevController())}checkPattern(t){const i=this.inputGroup.pattern;return!t.split("").some(((t,e)=>{if("§"===i[e]){if(/\d/.test(t))return!0}else if("#"===i[e]){if(!/\d/.test(t))return!0}else if(i[e]!==t)return!0;return!1}))}inputInNextGroupedInput(t,i,e=!1,s,n){this.onOverflow({data:t,input:this,paste:i,shouldPrefix:e,focusNext:s,caretPosition:n})}focusPrevController(){this.onGotoGroup(this,!0)}focusNextController(){this.onGotoGroup(this,!1)}handleArrowKey(t){t.preventDefault();const i=this.inputElement.selectionStart,e=this.inputElement.value.length;null!=e&&(this.caretPosition===i&&("ArrowLeft"===t.key?0!==i&&0!==e||this.focusPrevController():"ArrowRight"===t.key&&(i!==e&&0!==e||this.focusNextController())),this.caretPosition=i)}onBlur(){this.caretPosition=null}recomputeTextInputWidth(){const t=document.createElement("span");t.style.fontFamily="Helvetica Neue LT W01",t.style.height="auto",t.style.width="auto",t.style.position="absolute",t.style.whiteSpace="no-wrap",t.style.top="-10000px",t.style.opacity="0",t.innerHTML=this.inputElement.value.length>0?this.inputElement.value:this.inputGroup.pattern,document.body.appendChild(t);const i=Math.max(t.clientWidth,8*this.inputGroup.width);document.body.removeChild(t),this.inputElement.style.width=`${i}px`}}const m=class{constructor(e){t(this,e),this.valueChange=i(this,"valueChange",7),this.valueComplete=i(this,"valueComplete",7),this.allGroupedTextInputController=[],this.groups=[],this.active=!1,this.userInputed=!1,this.label="",this.value="",this.error=!1,this.disabled=!1,this.required=!1,this.readonly=!1}onMaskChanged(){this.reConstructInputsAndDelimiter()}onValueChanged(){this.obtainValueFromOutside()}connectedCallback(){this.reConstructInputsAndDelimiter()}componentWillLoad(){this.internalValue=this.computeNewValue()}componentDidRender(){this.obtainValueFromOutside()}obtainValueFromOutside(){if(this.value===this.computeNewValue()||0===this.value.length)return;const t=this.normalizeValue();this.clearAllInputs();const i=new InputEvent("input",{data:t,inputType:"insertFromPaste",detail:a({prefix:!0,focusNext:!1})});o((()=>{this.getFirstController().getInputElement().dispatchEvent(i)}))}checkFilledOut(){return this.allGroupedTextInputController.filter((t=>null!=t)).every((t=>t.checkIsFulfilled()))}normalizeValue(){if(this.value.length<=0)return"";const t=[...this.value];return[...this.mask].forEach(((i,e)=>{if(i.match(b)){if(!(e<=t.length))return;t[e]==i&&(t[e]="")}})),t.reduce(((t,i)=>t+i))}findInnerInputElement(t){return t.composedPath().find((t=>/input-[\d]+/.test(null==t?void 0:t.id)))}focusFirstUnfulfilledInput(){const t=this.allGroupedTextInputController.filter((t=>null!=t)).find((t=>!t.checkIsFulfilled()));t?t.focus():this.focusFirstInput()}focusFirstInput(){var t;null===(t=this.allGroupedTextInputController.filter((t=>null!=t))[0])||void 0===t||t.focus()}blurAllInputs(){this.allGroupedTextInputController.filter((t=>null!=t)).forEach((t=>{t.getInputElement().blur()}))}blurWhenInactive(){setTimeout((()=>{!this.forceBlur&&h(this.self)||(this.active=!1,this.forceBlur=!1,this.valueComplete.emit(this.internalValue))}),200)}checkUserInputed(){this.userInputed=this.allGroupedTextInputController.filter((t=>null!=t)).some((t=>{var i;return(null===(i=t.getInputValue())||void 0===i?void 0:i.length)>0}))}clearAllInputs(){o((()=>{this.allGroupedTextInputController.filter((t=>null!=t)).forEach((t=>{t.clearInput()})),this.value="",this.internalValue="",this.valueChanged()})),this.userInputed=!1}reConstructInputsAndDelimiter(){this.groups=function(t){const i=[...t],e=[];let s=0,n=new p,r=new f,o="";return i.forEach(((t,h)=>{t.match(v)?""==o||t==o?(++s,n.pattern=n.pattern+t,o=t):o!=t&&0===s?(++s,o=t,n.pattern=n.pattern+t):(n.width=s,e.push(n),n=new p,s=1,n.pattern=n.pattern+t,o=t):t.match(b)&&(s>0&&(n.width=s,e.push(n),n=new p),r.delimiter=t,e.push(r),r=new f,s=0),h==i.length-1&&(s>0&&(n.width=s,e.push(n)),n=new p)})),e}(this.mask),this.allGroupedTextInputController=this.groups.map((t=>{if(t instanceof p){const i=new x(t);return t.controller=i,i}}))}handleInput(t,i){this.checkUserInputed(),i.onInput(t)}handleKeyDown(t,i){i.handleKeyDown(t)}getFirstController(){const t=this.allGroupedTextInputController.filter((t=>null!=t));return t.length>0?t[0]:null}getNextController(t){let i,e=this.allGroupedTextInputController.indexOf(t),s=!1;for(;e<=this.allGroupedTextInputController.length&&!s;)e+=1,null!=this.allGroupedTextInputController[e]&&(i=this.allGroupedTextInputController[e],s=!0);return i}getPreviousController(t){let i,e=this.allGroupedTextInputController.indexOf(t),s=!1;for(;e>=0&&!s;)e-=1,null!=this.allGroupedTextInputController[e]&&(i=this.allGroupedTextInputController[e],s=!0);return i}focusPreviousController(t){const i=this.getPreviousController(t);if(null!=i){const t=i.getInputValue().length;i.focusAndSetCaretPosition(t,t)}}focusNextController(t){var i;null===(i=this.getNextController(t))||void 0===i||i.focusAndSetCaretPosition(0,0)}writeOverflowToNextInputController(t){const i=this.getNextController(t.input);if(null!=i||!this.checkFilledOut())if(t.paste){const e=new InputEvent("input",{data:t.data,inputType:"insertFromPaste",detail:a({prefix:t.shouldPrefix,focusNext:t.focusNext})});i.getInputElement().dispatchEvent(e)}else{const e=new InputEvent("input",{data:t.data,inputType:"insertText",detail:a({prefix:t.shouldPrefix,focusNext:t.focusNext})}),s=null==i?void 0:i.getInputElement();if(null==s)return;s.dispatchEvent(e),t.focusNext&&i.focusAndSetCaretPosition(t.caretPosition,t.caretPosition)}}computeNewValue(){return this.groups.filter((t=>t instanceof p||t instanceof f)).map((t=>{var i;return t instanceof f?t.delimiter:t instanceof p?null!==(i=t.controller.getInputValue())&&void 0!==i?i:"":void 0})).reduce(((t,i)=>t+i))}valueChanged(){const t=this.computeNewValue();this.internalValue!==t&&(this.internalValue=t,this.value=this.internalValue,this.valueChange.emit(t))}handleOnKeyUp(t,i){"Enter"==t.key?(this.forceBlur=!0,this.blurAllInputs(),this.self.blur()):"ArrowLeft"===t.key||"ArrowRight"===t.key?this.handleArrowKeys(t,i):this.handleKeyDown(t,i)}handleArrowKeys(t,i){i.handleArrowKey(t)}onDeleteBackwards(t,i){const e=this.getNextController(t);if(null!=e&&e.getInputGroup().pattern[0]===t.getInputGroup().pattern[0]&&e.getInputValue().length>0){const s=t.getInputGroup().width-t.getInputValue().length;t.appendExtractedToValue(e.extractCharacters(s,i),i)}}initalizeGroupedTextInputController(t,i){t.setInputElement(i),t.onGotoGroup=(t,i)=>{i?this.focusPreviousController(t):this.focusNextController(t)},t.onOverflow=t=>{this.writeOverflowToNextInputController(t)},t.onValueChanged=()=>{this.valueChanged()},t.onDeleteEvent=(t,i)=>{this.onDeleteBackwards(t,i)}}render(){var t;const i=(null===(t=this.errormessage)||void 0===t?void 0:t.length)>0||this.error;return e(s,{title:this.mask,onClick:t=>{null==this.findInnerInputElement(t)&&this.focusFirstUnfulfilledInput()},onBlur:()=>{this.blurWhenInactive()}},e("ds-input-label",{disabled:this.disabled,label:this.label,kisynced:!1}),e("div",{class:{"input-readonly":this.readonly}},e(l,{active:this.active,error:i,required:this.required,requirementFulfilled:this.checkFilledOut(),disabled:this.disabled,title:this.internalValue},this.renderReadonly(),this.renderGroups(),this.renderClearButton(),e(c,{text:this.errormessage,show:this.active})),e("ds-required-hint",{required:this.required,fulfilled:this.checkFilledOut()})))}renderGroups(){return this.groups.map(((t,i)=>{if(t instanceof p){const s=this.allGroupedTextInputController[i];return e("input",{id:`input-${i}`,ref:t=>{this.initalizeGroupedTextInputController(s,t)},disabled:this.disabled,placeholder:t.pattern,style:{"--ds-grouped-text-input-width":`${t.width}ch`},onFocus:()=>{this.active=!0},onBlur:()=>{s.onBlur()},onKeyUp:t=>{this.handleOnKeyUp(t,s)},onInput:t=>this.handleInput(t,s)})}return e("ds-text",{type:"ft",screensize:"small"}," "===t.delimiter?" ":t.delimiter)}))}renderReadonly(){return this.readonly?(this.computeNewValue(),e("div",{class:"readonly-text"},e(u,{text:this.internalValue,kisynced:!1}))):null}renderClearButton(){const t=this.active&&this.userInputed&&!this.readonly;return e("ds-function-icon-button",{id:r.createId(this.self,"clear-button"),unfocusable:!0,class:{"clear-button":!0,visible:t},onPointerDown:()=>this.clearAllInputs()},e("ds-icon",{icon:"schliessen-input",size:16}))}get self(){return n(this)}static get watchers(){return{mask:["onMaskChanged"],value:["onValueChanged"]}}};m.style=':host{display:block}:host:host([hidden]){display:none !important}:host .input-readonly .container{border:none;visibility:hidden}:host .input-readonly .container>input{pointer-events:none}:host .input-readonly .container .readonly-text{position:absolute;visibility:initial;color:#4c4c4c}:host .container{position:relative;top:0;left:0;display:flex;height:38px;border-radius:4px;border:1px solid #c1c1c1;background-color:#ffffff;box-sizing:border-box;align-items:center}:host .container.required-outline{border-color:#e8b50e}:host .container.requirement-fulfilled{border-color:#c1c1c1}:host .container.red-outline{border-color:#be1413}:host .container.disabled-outline{border-color:#ebebeb}:host .container.active{border-color:#4c4c4c}:host .container>ds-text:first-child{margin-left:8px}:host .container>input{height:22px;margin:8px 0 8px 8px;border:none;outline:none;font-family:"Helvetica Neue", "Helvetica Neue LT W01";font-size:16px;line-height:24px;letter-spacing:0.02px;color:#4c4c4c;width:1px;flex-grow:1;width:var(--ds-grouped-text-input-width, 4ch);display:inline;flex-grow:0;margin:0;padding:0;line-height:24px}:host .container>input::placeholder{color:#c1c1c1}:host .container>input:disabled{background-color:#ffffff;color:#c1c1c1}:host .container>input:first-child{margin-left:8px}:host .container ds-function-icon-button{margin-left:auto}:host .container.disabled-outline>ds-text{color:#dedede}:host .container.disabled-outline input{color:#dedede}:host .clear-button{visibility:hidden}:host .clear-button.visible{visibility:visible}';export{m as ds_grouped_text_input}