import{r as t,c as i,h as e,H as s,g as o}from"./p-c66bef8d.js";import{a as n}from"./p-dc250dcd.js";import{v as r,E as l}from"./p-70f48e14.js";import{E as h,h as a}from"./p-747d527e.js";import{h as d,a as c}from"./p-aa0a06c6.js";import{n as p}from"./p-fabbcf47.js";import{o as u}from"./p-90458c1b.js";import{c as m}from"./p-968cb048.js";import{f as x}from"./p-9e335670.js";import{R as b}from"./p-9e9cb538.js";import{L as v}from"./p-ea00c415.js";import"./p-15b13381.js";const f=class{constructor(e){t(this,e),this.valueChange=i(this,"valueChange",7),this.valueComplete=i(this,"valueComplete",7),this.lastEmittedChangeValue=null,this.lastEmittedCompleteValue=null,this.preventReFocus=!1,this.selectScanningEnabled=!0,this.options=[],this.inputFocused=!1,this.listOpen=!1,this.internalValue=[],this.showMouseHoverEffectOnList=!0,this.activeIndex=null,this.size="m",this.selectionlabel="Gewählte Kategorien",this.readonly=!1,this.required=!1,this.kisynced=!1,this.placeholder="Bitte auswählen ...",this.textalign="left",this.popupposition="bottom",this.disabled=!1}componentWillLoad(){this.internalPopupPosition=this.popupposition,r(this.self)}connectedCallback(){this.optionsObserver=m(this.self,"dx-dropdown-option",(async t=>{await this.collectOptions(t);const i=x(this.options);n(0==i.length,(()=>`It is not allowed for multiple 'dx-dropdown-option' elements to share the same value!\nFollowing duplicated value were found: ${i.join()}`),this.self)}))}disconnectedCallback(){var t;null===(t=this.optionsObserver)||void 0===t||t.disconnect(),clearInterval(this.observeSelectElementIntervalHandle)}onForceUpdateOnChange(t){t.detail(this.self)}async focusControl(){this.inputElement.focus()}async collectOptions(t){this.options=await Promise.all(t.map((t=>t.toOption())))}onInputFocused(){this.inputFocused=!0}onInputBlurred(){u((()=>{this.preventReFocus||!c(this.self)?(this.inputFocused=!1,this.setOpenListStatus(!1),this.emitValueChange(),this.emitValueComplete()):this.inputElement.focus(),this.preventReFocus=!1}))}toggleList(){this.setOpenListStatus(!this.listOpen)}onInputKeyUp(t){["Enter","Escape"].includes(t.code)&&(this.setOpenListStatus(!1),this.emitValueComplete())}onInputKeyDown(t){const i=this.self.shadowRoot.querySelector("dx-list-flyout");t.target!==i&&(["ArrowDown","ArrowUp","Space"].includes(t.code)&&t.preventDefault(),this.listOpen?null==i||i.dispatchEvent(new t.constructor(t.type,t)):"ArrowDown"!==t.code&&"ArrowUp"!==t.code||this.setOpenListStatus(!0))}onInputClicked(){this.disabled||this.toggleList()}setOpenListStatus(t){this.listOpen=t,this.listOpen&&this.inputElement.focus()}selectOptionsByValue(t){t===g?this.internalValue.length>0&&(this.internalValue=[],this.emitValueChange()):null!=this.options.filter((i=>JSON.stringify(i.value)===t))&&this.emitValueChange()}get selectedDropdownOptions(){return this.options.filter((t=>t.selected))}get selectedOptions(){return this.selectedDropdownOptions.map((t=>t.value))}get selectedDropdownOptionElements(){return Array.from(this.getInnerDropdownOptionElements()).filter((t=>t.selected))}compareArray(t,i){return(null==t?void 0:t.length)===(null==i?void 0:i.length)&&(null==t?void 0:t.every((t=>null==i?void 0:i.includes(t))))}emitValueChange(){const t=this.selectedDropdownOptionElements;this.compareArray(this.lastEmittedChangeValue,t)||(this.valueChange.emit(t),this.lastEmittedChangeValue=t)}emitValueComplete(){const t=this.selectedDropdownOptionElements;this.compareArray(this.lastEmittedCompleteValue,t)||(this.valueComplete.emit(t),this.lastEmittedCompleteValue=t)}superviseSelectElement(t){clearInterval(this.observeSelectElementIntervalHandle),d(t,"value",(()=>{const i=Array.from(t.options).filter((t=>t.selected)).join(",");this.selectScanningEnabled&&!this.readonly&&(()=>{const i=this.options.length+1;return t.querySelectorAll("option").length>=i})()&&this.selectOptionsByValue(i)}))}onItemSelectionChanged(t){this.getInnerDropdownOptionElements().forEach((i=>{var e;i.selected=-1!==(null===(e=t.detail.selectedItems)||void 0===e?void 0:e.indexOf(i.value||i.label))})),this.emitValueChange()}onPopupPositionChanged(t){this.internalPopupPosition=t.detail}getInnerDropdownOptionElements(){return this.self.querySelectorAll(p("dx-dropdown-option"))}isChevronRotated(){let t=this.listOpen;return"top"===this.internalPopupPosition&&(t=!t),t}render(){var t,i,o,n;return this.readonly?e(b,{text:null!==(t=this.selectedDropdownOptions.map((t=>t.label)).join(", "))&&void 0!==t?t:"",label:this.label}):e(s,{class:{disabled:this.disabled}},e("div",{class:{input:!0,"size-s":"s"===this.size,"size-m":"m"===this.size},ref:t=>this.inputElement=t,id:l.createId(this.self,"user-interaction"),tabIndex:this.disabled?-1:0,onKeyDown:t=>this.onInputKeyDown(t),onKeyUp:t=>this.onInputKeyUp(t),onFocus:()=>this.onInputFocused(),onBlur:()=>this.onInputBlurred(),onClick:()=>this.onInputClicked()},e("dx-list-flyout",{open:this.listOpen,position:this.popupposition,direction:"left"===this.textalign?"right":"left",itemsvisible:5.5,size:"m",selectionmode:"multi",stopclickpropagationonpopup:!0,class:{"respect-label-height":(null===(i=this.label)||void 0===i?void 0:i.length)>0}},e(v,{slot:"base",containerProperties:{active:this.inputFocused,size:this.size,error:a(this.self),title:null===(n=null===(o=this.selectedDropdownOptions)||void 0===o?void 0:o.map((t=>{var i;return null!==(i=null==t?void 0:t.label)&&void 0!==i?i:t.value})))||void 0===n?void 0:n.join(",")},labelProperties:{label:this.label,disabled:this.disabled,required:this.required,kisynced:this.kisynced}},this.renderNativeSelect(),this.renderCurrentValue(),this.renderOpenListButton()),this.renderItemList())),e(h,{self:this.self,message:this.errormessage,custom:{onFocus:()=>{this.preventReFocus=!0},onBlur:()=>{this.preventReFocus=!1}}}))}renderNativeSelect(){const t=[{label:"-",value:g,icon:null,selected:0===this.selectedOptions.length},...this.options];return e("select",{id:l.createId(this.self,"control"),ref:t=>this.superviseSelectElement(t),tabIndex:-1,onChange:t=>{this.selectOptionsByValue(t.target.value)},multiple:!0},t.map((t=>e("option",{selected:t.value===this.internalValue||null===this.internalValue&&t.value===g,value:JSON.stringify(t.value)},t.label))))}renderOpenListButton(){return e("div",{id:l.createId(this.self,"open-list-button"),class:{"open-list-button":!0}},e("dx-chevron",{directiontop:this.isChevronRotated(),active:this.inputFocused}))}renderItemList(){return this.options.map(((t,i)=>e("dx-list-item",{id:l.createId(this.self,`list-item-${i}`),type:"checkbox",value:t.value,label:t.label,icon:t.icon,textalign:this.textalign,selected:t.selected})))}renderOption(t,i=!1){return e("div",{id:i?void 0:l.createId(this.self,`item-list-value-${t.value}`),class:{item:!0,"is-placeholder":i,right:"right"==this.textalign,selected:t.selected,disabled:!0===this.disabled}},null!=t.icon?e("dx-icon",{size:24,icon:t.icon}):null,e("dx-text",{key:t.label,class:{label:!0,"align-right":"right"===this.textalign}},t.label))}renderCurrentValue(){const t=this.selectedOptions;return e("div",{class:"current-value"},t.length>0?this.renderOption({label:`${this.selectionlabel} (${t.length})`,value:t,icon:this.icon,selected:!0},!1):this.renderOption({label:this.placeholder,icon:this.icon,value:"",selected:!1},!0))}get self(){return o(this)}},g="null";f.style=":host{min-width:0;-webkit-tap-highlight-color:transparent;display:block;min-width:0}:host:host([hidden]){display:none !important}:host:host(.disabled){pointer-events:none}:host:host(.disabled:not(.nested-form-element)){opacity:0.4}:host .input{outline:none;cursor:pointer}:host .input.disabled{cursor:default;pointer-events:none}:host .input dx-list-item[type=default]{cursor:default}:host .input .container.size-s{position:relative;top:0;left:0;display:flex;height:40px;padding:8px 16px 8px 16px;--dx-info-button-offset-y:0px;box-sizing:border-box;border:1px solid #d6d6d6;border-bottom:var(--dx-container-border-bottom, 1px solid #d6d6d6);background-color:#ffffff;align-items:center;--dx-icon-color:#337a96}:host .input .container.size-s.error{border-color:#9d2235;background-color:#f5e9eb}:host .input .container.size-s.error input,:host .input .container.size-s.error textarea{background:transparent}:host .input .container.size-s.active{border-color:#004763;--dx-text-color:#004763;--dx-icon-color:#004763}:host .input .container.size-m{position:relative;top:0;left:0;display:flex;height:48px;padding:10px 16px 10px 16px;box-sizing:border-box;border:1px solid #d6d6d6;border-bottom:var(--dx-container-border-bottom, 1px solid #d6d6d6);background-color:#ffffff;align-items:center;--dx-icon-color:#337a96}:host .input .container.size-m.error{border-color:#9d2235;background-color:#f5e9eb}:host .input .container.size-m.error input,:host .input .container.size-m.error textarea{background:transparent}:host .input .container.size-m.active{border-color:#004763;--dx-text-color:#004763;--dx-icon-color:#004763}:host .input .container select{position:absolute;width:100%;left:0;top:0;pointer-events:none;opacity:0}:host .input .container .current-value{flex:1;overflow:hidden;user-select:none;--dx-text-font-weight:var(--dx-dropdown-selected-font-weight, 500)}:host .input .container .current-value .item{display:flex;align-items:center;--dx-text-color:#2b2b2b;--dx-icon-color:#337a96}:host .input .container .current-value .item dx-icon{margin-right:16px;flex-shrink:0}:host .input .container .current-value .item dx-text{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}:host .input .container .current-value .item.is-placeholder{--dx-text-color:#337a96}:host .input .container .current-value .item .label.align-right{margin-left:auto}:host .input .container.active .current-value .item{--dx-text-color:#004763}:host .input .container .open-list-button{margin-left:16px;width:24px;height:24px;pointer-events:none}:host .input .respect-label-height{--dx-overlay-offset:-24}@media (min-width: 1280px){:host .input .respect-label-height{--dx-overlay-offset:-28}}";export{f as dx_multi_dropdown}