import{r as t,c as i,h as s,H as e,g as h}from"./p-c66bef8d.js";import{E as n}from"./p-70f48e14.js";import{o}from"./p-90458c1b.js";import{c as l}from"./p-e0194d22.js";import{D as r,f as a}from"./p-31a88832.js";import{R as d}from"./p-4de2e84c.js";import{D as u}from"./p-dde9fdba.js";import{I as c}from"./p-38e28938.js";import{a as p}from"./p-aa0a06c6.js";import"./p-15b13381.js";class v{constructor(t,i,s,e,h){this.minValue=t,this.maxValue=i,this.disabled=s,this.formatter=e,this.maxCharacters=h,this.inputElement=null,this.lastValue="",this.valueBeforeFocus=""}focus(){var t,i;this.lastValue=null===(t=this.inputElement)||void 0===t?void 0:t.value,this.valueBeforeFocus=this.lastValue,null===(i=this.inputElement)||void 0===i||i.focus()}setValue(t){this.disabled&&(t=r.withMultipleLeadingZeros(this.minValue,4)),this.internalSetValue(null==t||isNaN(+t)?"":t.toString()),this.format()}setInputElementValue(t){null!=this.inputElement&&(this.inputElement.value=t)}internalSetValue(t){this.setInputElementValue(t),this.lastValue=t}sendInput(t){var i;this.setInputElementValue(t);const s=new Event("input",{bubbles:!0,cancelable:!0});s.data=t,s.insertType="insertText",null===(i=this.inputElement)||void 0===i||i.dispatchEvent(s)}preventInput(t,i){if(/delete|history/.test(i))return!1;if("."===t)return this.lastValue!==this.valueBeforeFocus&&this.finish(),!0;const s=Number(t);return!!isNaN(s)||void 0}onInput(t){t.preventDefault();const i=this.inputElement.value;if(this.preventInput(t.data,t.inputType))return this.lastValue===this.valueBeforeFocus&&requestAnimationFrame((()=>{this.inputElement.select()})),void this.internalSetValue(this.lastValue);const s=i.substr(0,this.maxCharacters);this.internalSetValue(s),s.length===this.maxCharacters&&this.finish()}get formattedValue(){var t,i;return null!==(i=this.formatter(null===(t=this.inputElement)||void 0===t?void 0:t.value))&&void 0!==i?i:""}getDisabled(){return this.disabled}setDisabled(t){this.disabled=!!t}finish(){var t;null===(t=this.onFinished)||void 0===t||t.call(this),this.format()}format(){var t,i,s,e,h;const n=parseInt(null===(t=this.inputElement)||void 0===t?void 0:t.value);if(isNaN(n))return void this.internalSetValue("");const o=l(n,this.minValue,this.maxValue);this.internalSetValue(o===n?null===(i=this.formatter)||void 0===i?void 0:i.call(this,null===(s=this.inputElement)||void 0===s?void 0:s.value):null!==(h=null===(e=this.formatter)||void 0===e?void 0:e.call(this,o.toString()))&&void 0!==h?h:"")}isEmpty(){var t,i,s;return this.disabled||0===(null!==(s=null===(i=null===(t=this.inputElement)||void 0===t?void 0:t.value)||void 0===i?void 0:i.length)&&void 0!==s?s:0)}clearInput(){this.disabled||null==this.inputElement||this.internalSetValue(null)}onFocus(){this.inputElement.value.length>0&&(this.focus(),this.inputElement.select())}onBlur(){this.valueBeforeFocus=this.lastValue,this.format()}setInputElement(t){this.inputElement!==t&&(this.inputElement=t,o((()=>{this.format()})))}incrementValue(){const t=""===this.inputElement.value?this.minValue:parseInt(this.inputElement.value)+1;this.setValue(t%(this.maxValue+1)),requestAnimationFrame((()=>{this.inputElement.select()}))}decrementValue(){const t=""===this.inputElement.value?this.maxValue:parseInt(this.inputElement.value)-1;this.setValue(t-this.minValue<0?this.maxValue+(t-this.minValue)+1:t%(this.maxValue+1)),requestAnimationFrame((()=>{this.inputElement.select()}))}}const m=class{constructor(s){t(this,s),this.valueChange=i(this,"valueChange",7),this.valueComplete=i(this,"valueComplete",7),this.errorFound=i(this,"errorFound",7),this.segmentBlur=i(this,"segmentBlur",7),this.dayEmpty=!0,this.monthEmpty=!0,this.yearEmpty=!0,this.currentlyEditing=!1,this.inputFocused=!1,this.internalValue=null,this.value=null,this.error=!1,this.disabled=!1,this.readonly=!1,this.required=!1,this.kisynced=!1,this.mode="day-month-year",this.calendarenabled=!0,this.dayInputController=null,this.monthInputController=null,this.yearInputController=null,this.currentFocusedIndex=null}valueChanged(){this.obtainValueChangesFromOutside()}readonlyChanged(){o((()=>{this.updateInputSegments(),this.checkInputs()}))}onModeChange(){this.updateInputControllerDisableStates()}async focusControl(){this.getInputController(0).focus()}async internalForceEmitChangeEvent(){this.valueChange.emit(this.value),this.valueComplete.emit(this.value),this.lastEmittedChangeValue=this.value,this.lastEmittedCompleteValue=this.value}connectedCallback(){this.initalizeInputController()}componentWillLoad(){const t=()=>{this.focusNext()};this.dayInputController.onFinished=t,this.monthInputController.onFinished=this.isYearEnabled?t:null,this.yearInputController.onFinished=null,this.checkInputs()}componentDidLoad(){this.updateInputSegments(),this.updateCalendarValue(),requestAnimationFrame((()=>{this.checkInputs()}))}componentWillRender(){this.value=r.dateToString(this.adjustDateDependantOnCurrentMode(r.newDateFromString(this.value)))}initalizeInputController(){this.yearInputController=new v(0,9999,!this.isYearEnabled(),a,4),this.monthInputController=new v(1,12,!this.isMonthEnabled(),b,2),this.dayInputController=new v(1,31,!this.isDateEnabled(),b,2)}updateInputControllerDisableStates(){this.dayInputController.setDisabled(!this.isDateEnabled()),this.monthInputController.setDisabled(!this.isMonthEnabled()),this.yearInputController.setDisabled(!this.isYearEnabled())}adjustDateDependantOnCurrentMode(t){if(r.isValidDate(t)&&!this.isYearEnabled()){const i=new Date(t);return i.setFullYear(0),i}return t}checkInputs(){this.dayEmpty=!this.isDateEnabled()||this.dayInputController.isEmpty(),this.monthEmpty=!this.isMonthEnabled()||this.monthInputController.isEmpty(),this.yearEmpty=!this.isYearEnabled()||this.yearInputController.isEmpty(),this.checkValueValidity()}isDateEnabled(){return"month-year"!==this.mode}isMonthEnabled(){return!0}isYearEnabled(){return"day-month"!==this.mode}updateInputSegments(){this.dayInputController.setValue(this.day),this.monthInputController.setValue(this.month),this.yearInputController.setValue(this.year)}focusNext(){var t;const i=((null!==(t=this.currentFocusedIndex)&&void 0!==t?t:-1)+1)%3;this.focus(i)}focusPrevious(){var t;const i=((null!==(t=this.currentFocusedIndex)&&void 0!==t?t:0)+3-1)%3;this.focus(this.isDateEnabled()||0!==i?i:2)}focus(t){var i;null===(i=this.getInputController(t))||void 0===i||i.focus()}obtainValueChangesFromOutside(){var t;const i=null!==(t=this.formatToDateString(this.value))&&void 0!==t?t:"";this.value!==this.internalValue&&(this.internalValue=i,this.lastEmittedChangeValue=this.value,this.lastEmittedCompleteValue=this.value,this.updateInputSegments(),this.checkInputs()),this.checkValueValidity()}checkValueValidity(){let t=u.NO_ERROR;null==this.value?this.isInputValid()&&(t=u.INVALID_DATE):this.min&&r.isBeforeDate(new Date(this.value),new Date(this.min))?t=u.UNDER_MIN:this.max&&r.isAfterDate(new Date(this.value),new Date(this.max))&&(t=u.OVER_MAX);const i=this.getErrorMessage(t);t===this.lastErrorType&&i===this.internalErrorMessage||(this.internalErrorMessage=i,this.errorFound.emit({type:t,message:this.internalErrorMessage}),this.lastErrorType=t)}getErrorMessage(t){return{[u.INVALID_DATE]:()=>`Das eingegebene Datum ${this.dayInputController.formattedValue}.${this.monthInputController.formattedValue}.${this.yearInputController.formattedValue} ist nicht valide.`,[u.UNDER_MIN]:()=>`Das eingegebene Datum muss nach dem ${this.getFormattedDisplayDate(this.min)} liegen.`,[u.OVER_MAX]:()=>`Das eingegebene Datum muss vor dem ${this.getFormattedDisplayDate(this.max)} liegen.`,[u.NO_ERROR]:()=>""}[t]()}getFormattedDisplayDate(t){const i=r.getFormattedDisplayDate(t);if("day-month-year"===this.mode)return i;const s=i.split(".");return"day-month"===this.mode?`${s[0]}.${s[1]}`:"month-year"===this.mode?`${s[1]}.${s[2]}`:void 0}emitValueChange(){this.lastEmittedChangeValue!==this.internalValue&&(this.value=this.internalValue,this.valueChange.emit(this.value),this.lastEmittedChangeValue=this.value,this.checkInputs())}emitValueComplete(){this.lastEmittedCompleteValue!==this.value&&(this.updateCalendarValue(),this.valueComplete.emit(this.value),this.lastEmittedCompleteValue=this.value,this.checkInputs())}updateCalendarValue(){null!=this.calendar&&(this.calendar.value=this.value)}isValueValid(){if(null==this.value)return!1;const t=new Date(this.value);return!isNaN(t.getTime())}isInputValid(){return parseFloat(this.dayInputController.formattedValue)*parseFloat(this.monthInputController.formattedValue)*parseFloat(this.yearInputController.formattedValue)>0}formatToDateString(t){if(null==t)return null;const i=new Date(t);if(isNaN(i.getTime()))return null;{const s=t.split("-").map((t=>parseFloat(t)));return s[2]!==i.getDate()||s[1]!==i.getMonth()+1||s[0]!==i.getFullYear()?null:r.dateToString(i)}}onFocusInput(){this.inputFocused=!0}handleKeyInput(t){if("Enter"===t.code)t.target.blur();else if(!t.code.startsWith("Arrow")){if("Tab"!==t.code&&!t.code.startsWith("Shift")&&!this.currentlyEditing){this.currentlyEditing=!0,this.currentFocusedIndex=0;const i=this.getInputController(this.currentFocusedIndex);i.focus(),i.sendInput(t.key),t.preventDefault()}return}t.code.includes("Arrow")&&(t.preventDefault(),"ArrowLeft"===t.code?this.focusPrevious():"ArrowRight"===t.code?this.focusNext():"ArrowUp"===t.code?this.incrementCurrentSegment():"ArrowDown"===t.code&&this.decrementCurrentSegment())}incrementCurrentSegment(){var t;null===(t=this.getInputController(this.currentFocusedIndex))||void 0===t||t.incrementValue(),this.updateInternalValue()}decrementCurrentSegment(){var t;null===(t=this.getInputController(this.currentFocusedIndex))||void 0===t||t.decrementValue(),this.updateInternalValue()}getInputController(t){return 0===(t+=0!==t||this.isDateEnabled()?0:1)?this.dayInputController:1===t?this.monthInputController:2===t?this.yearInputController:void 0}clearInput(){this.dayInputController.clearInput(),this.monthInputController.clearInput(),this.yearInputController.clearInput(),this.dayEmpty=!0,this.monthEmpty=!0,this.yearEmpty=!0,this.updateInternalValue()}onBlur(){this.updateInternalValue(),this.updateCalendarValue(),this.segmentBlur.emit(),o((()=>{p(this.self)||(this.currentlyEditing=!1,this.currentFocusedIndex=null,this.inputFocused=!1,this.emitValueComplete())}))}setFocusedIndex(t){this.currentFocusedIndex=t,this.currentlyEditing=!0}get day(){if(null==this.value)return null;const t=new Date(this.value).getDate();return r.withMultipleLeadingZeros(t,2)}get month(){if(null==this.value)return null;const t=new Date(this.value).getMonth()+1;return r.withMultipleLeadingZeros(t,2)}get year(){if(null==this.value)return null;const t=new Date(this.value).getFullYear();return r.withMultipleLeadingZeros(t,4)}handleInput(t,i){i.onInput(t),this.updateInternalValue()}updateInternalValue(){const t=this.dayInputController.getDisabled()?"01":this.dayInputController.formattedValue,i=this.monthInputController.getDisabled()?"01":this.monthInputController.formattedValue,s=this.yearInputController.getDisabled()?"0000":this.yearInputController.formattedValue,e=""!==t&&""!==i&&""!==s?this.formatToDateString(`${s}-${i}-${t}`):null;e!==this.value&&(this.internalValue=e,this.emitValueChange()),this.checkInputs()}selectDate(t){var i;this.internalValue=r.dateToString(t),this.emitValueChange();const s=null===(i=this.value)||void 0===i?void 0:i.split("-");null!=s?(this.dayInputController.setValue(null==s?void 0:s[2]),this.monthInputController.setValue(null==s?void 0:s[1]),this.yearInputController.setValue(null==s?void 0:s[0])):this.clearInput(),this.checkInputs(),this.dayInputController.focus()}setCalendar(t){t!==this.calendar&&(this.calendar=t,this.updateCalendarValue())}renderHiddenFallbackInput(t){return s("input",{hidden:!0,tabIndex:-1,ref:i=>{t.setInputElement(i)},type:"text",disabled:!0})}renderDayInput(){return this.isDateEnabled()?[s("input",{id:n.createId(this.self,"day-control"),tabIndex:this.currentlyEditing?0:-1,ref:t=>{this.dayInputController.setInputElement(t)},type:"text",class:{day:!0},onFocus:()=>{this.setFocusedIndex(0),this.dayInputController.onFocus(),this.onFocusInput()},onBlur:()=>{this.dayInputController.onBlur(),this.onBlur()},placeholder:"TT",maxLength:2,onChange:()=>this.updateInternalValue(),onInput:t=>this.handleInput(t,this.dayInputController),disabled:this.disabled}),s("ds-text",{class:{dot:!0,disabled:this.dayInputController.isEmpty()}},".")]:this.renderHiddenFallbackInput(this.dayInputController)}renderMonthInput(){return this.isMonthEnabled()?[s("input",{id:n.createId(this.self,"month-control"),tabIndex:this.currentlyEditing?0:-1,ref:t=>{this.monthInputController.setInputElement(t)},type:"text",class:{month:!0,empty:this.monthEmpty},onFocus:()=>{this.setFocusedIndex(1),this.monthInputController.onFocus(),this.onFocusInput()},onBlur:()=>{this.monthInputController.onBlur(),this.onBlur()},placeholder:"MM",maxLength:2,onChange:()=>this.updateInternalValue(),onInput:t=>this.handleInput(t,this.monthInputController),disabled:this.disabled}),s("ds-text",{class:{dot:!0,disabled:this.monthInputController.isEmpty()}},".")]:this.renderHiddenFallbackInput(this.monthInputController)}renderYearInput(){return this.isYearEnabled()?s("input",{id:n.createId(this.self,"year-control"),tabIndex:this.currentlyEditing?0:-1,class:{year:!0,empty:this.yearEmpty},ref:t=>{this.yearInputController.setInputElement(t)},type:"text",onFocus:()=>{this.setFocusedIndex(2),this.yearInputController.onFocus(),this.onFocusInput()},onBlur:()=>{this.onBlur(),this.yearInputController.onBlur()},placeholder:"JJJJ",maxLength:4,onChange:()=>this.updateInternalValue(),onInput:t=>this.handleInput(t,this.yearInputController),disabled:this.disabled}):this.renderHiddenFallbackInput(this.yearInputController)}renderInput(){const t=this.errormessage||this.internalErrorMessage,i=(null==t?void 0:t.length)>0||this.error;return s("label",{id:n.createId(this.self,"control")},s("div",null,s("dx-overlay",{position:"bottom",offsety:8,disabled:!this.inputFocused},s(c,{active:this.inputFocused,error:i,required:this.required,requirementFulfilled:this.isValueValid(),disabled:this.disabled,custom:{tabIndex:this.currentlyEditing||this.disabled?-1:0,onFocus:()=>this.onFocusInput(),onBlur:()=>this.onBlur(),onInput:()=>this.checkInputs(),onKeyDown:t=>this.handleKeyInput(t)},title:this.getFormattedDisplayDate(this.value)},this.renderDayInput(),this.renderMonthInput(),this.renderYearInput(),this.renderIconOrClearButton()),this.renderCalendar(),s("ds-required-hint",{required:this.required,fulfilled:this.isValueValid()}))),s("ds-input-label",{label:this.label,kisynced:this.kisynced}))}renderClearButton(){return s("ds-function-icon-button",{id:n.createId(this.self,"clear-button"),unfocusable:!0,onBlur:()=>{this.onBlur(),this.dayInputController.onBlur()},class:{"clear-button":!0,visible:!0},onPointerDown:()=>this.clearInput()},s("ds-icon",{icon:"schliessen-input",size:16}))}renderIconOrClearButton(){return s("div",{class:"right-side"},!this.inputFocused||this.dayEmpty&&this.monthEmpty&&this.yearEmpty?s("ds-icon",{icon:"kalender",size:16}):this.renderClearButton())}renderCalendar(){var t,i;if(this.inputFocused&&this.calendarenabled)return s("ds-calendar",{slot:"overlay",id:n.createId(this.self,"calendar"),ref:t=>{this.setCalendar(t)},mode:this.mode,tabindex:-1,min:null!==(t=this.min)&&void 0!==t?t:"",max:null!==(i=this.max)&&void 0!==i?i:"",errormessage:this.internalErrorMessage||this.errormessage,onBlur:()=>{this.onBlur(),this.dayInputController.onBlur()},onRangeSelected:t=>{this.selectDate(t.detail.from)}})}render(){var t;if(this.readonly){const i=new Date(this.value);return s("div",{class:"read-only"},s(d,{text:(null===(t=this.value)||void 0===t?void 0:t.length)>0?this.getFormattedDisplayDate(i):"n.a.",label:this.label,alignRight:!0,kisynced:this.kisynced}))}return s(e,{class:{disabled:this.disabled}},this.renderInput())}get self(){return h(this)}static get watchers(){return{value:["valueChanged"],readonly:["readonlyChanged"],mode:["onModeChange"]}}};function b(t){return t?r.withLeadingZero(parseInt(t)):t}m.style=':host{display:block}:host:host([hidden]){display:none !important}:host:host([label]:not([label=""])){--ds-info-button-offset-y:24px}:host:host(.disabled){pointer-events:none;--ds-text-color:#dedede;--ds-icon-color:#dedede}:host label{display:flex;flex-direction:column-reverse}:host label div .container{position:relative;top:0;left:0;display:flex;height:38px;border-radius:4px;border:1px solid #c1c1c1;background-color:#ffffff;box-sizing:border-box;align-items:center;outline:none;justify-content:flex-end}:host label div .container.required-outline{border-color:#e8b50e}:host label div .container.requirement-fulfilled{border-color:#c1c1c1}:host label div .container.red-outline{border-color:#be1413}:host label div .container.disabled-outline{border-color:#ebebeb}:host label div .container.active{border-color:#4c4c4c}:host label div .container input{height:22px;margin:8px 0 8px 8px;border:none;outline:none;font-family:"Helvetica Neue", "Helvetica Neue LT W01";font-size:16px;line-height:24px;letter-spacing:0.02px;color:#4c4c4c;width:1px;flex-grow:1;flex:none;text-align:right;margin:0}:host label div .container input::placeholder{color:#c1c1c1}:host label div .container input:disabled{background-color:#ffffff;color:#c1c1c1}:host label div .container input.day{width:2.1ch}:host label div .container input.month{width:2ch}:host label div .container input.month.empty{width:3.2ch}:host label div .container input.year{width:4ch}:host label div .container input.year.empty{width:3.6ch}:host label div .container .dot.disabled{--ds-text-color:#c1c1c1}:host label div .container .right-side{display:flex;width:28px;height:28px;justify-content:center;align-items:center}:host .read-only{text-align:right}';export{m as ds_date_input}