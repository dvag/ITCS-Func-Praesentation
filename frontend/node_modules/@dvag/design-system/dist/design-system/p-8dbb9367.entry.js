import{r as t,c as i,a as s,w as e,f as n,h as o,H as l,g as a}from"./p-c66bef8d.js";import{D as r}from"./p-54eaab21.js";import{s as h,c as d}from"./p-aa0a06c6.js";import{a as c}from"./p-dc250dcd.js";import{E as u}from"./p-70f48e14.js";import{c as b}from"./p-985ad2ab.js";import{u as v}from"./p-372cf900.js";import"./p-15b13381.js";const p=class{constructor(s){t(this,s),this.tableStateChanged=i(this,"tableStateChanged",7),this.selectionStateChanged=i(this,"selectionStateChanged",7),this.expansionChanged=i(this,"expansionChanged",7),this.internalScrollChanged=i(this,"internalScrollChanged",7),this.rowsSelected=i(this,"rowsSelected",7),this.currentSortSettings={column:null,reverse:!1},this.sortDebounce=new r(50),this.rowDebounce=new r(200),this.touchMoveDetected=!1,this.expansionEnabled=!1,this.initialized=!1,this.scrollHandler=()=>{this.controlOpticalHints()},this.currentPage=1,this.selectedRowKeys=[],this.rowElements=[],this.internalScrollable=!1,this.pagesize=25,this.pagesizes=null,this.initialsortdirection="asc",this.mode="managed",this.selectionenabled=!1,this.selectionmode="multi",this.rowcount=0}onInternalScrollableChanged(){this.internalScrollChanged.emit(this.internalScrollable)}onSideBarOpenChange(){this.selectionenabled?this.getRows().every((t=>null==t.rowid))&&(console.warn("To use table selection you have to define at least one <dx-table-row> with a valid 'rowid'!\n",this.self),this.selectionenabled=!1):(this.selectedRowKeys=[],null!=this.selectionGroup?(this.selectionGroup.value=null,this.rowsSelected.emit(null)):this.rowsSelected.emit([])),this.controlOpticalHints(),this.emitSelectionChanged(),s((()=>v(this.updateTableScroll(this.self.offsetWidth))))}onSelectionModeChanged(){this.emitSelectionChanged()}onScrollableChange(){var t;this.setScrollable(),this.controlOpticalHints(),null===(t=this.headerItemElements)||void 0===t||t.forEach((t=>{t.usemaxwidth=this.internalScrollable}))}onTouchStart(){this.touchMoveDetected=!1}onTouchmove(){this.touchMoveDetected=!0}onTouchEnd(t){this.touchMoveDetected&&(t.stopImmediatePropagation(),this.touchMoveDetected=!1)}connectedCallback(){this.initialized=!1,this.mutationObserver=new MutationObserver((()=>{const t=this.self.querySelectorAll("dx-table-header-item"),i=this.self.querySelectorAll("dx-table-row");this.updateHeaderItems(Array.from(t)).then((()=>{this.updateRows(Array.from(i));const t=b(this.self);t!==this.expansionEnabled&&(this.expansionEnabled=t,this.expansionChanged.emit(t))}))})),this.mutationObserver.observe(this.self,{childList:!0,subtree:!0,attributes:!0}),this.setScrollable()}disconnectedCallback(){var t,i;null===(t=this.mutationObserver)||void 0===t||t.disconnect(),this.rowDebounce.reset(),this.sortDebounce.reset(),null===(i=this.tableResizeObserver)||void 0===i||i.disconnect()}initTableResizeObserver(){this.tableResizeObserver=new ResizeObserver((t=>{this.updateTableScroll(t[0].contentRect.width).then((()=>{this.controlOpticalHints()})),e((()=>{this.self.style.setProperty("--dx-table-width",`${t[0].contentRect.width}px`)}))}))}setScrollable(){var t;this.scrollable?this.initTableResizeObserver():(null===(t=this.tableResizeObserver)||void 0===t||t.disconnect(),this.tableResizeObserver=null,this.internalScrollable=!1,this.updateCellSettings().then(),e((()=>{this.self.style.removeProperty("--dx-table-width")})))}emitSelectionChanged(){this.selectionStateChanged.emit({enabled:this.selectionenabled,mode:this.selectionmode})}async updateTableHeaderWidths(){var t,i;const s=null!==(i=null===(t=this.headerItemElements)||void 0===t?void 0:t.map((async t=>{const i=await t.getMaxWidth();return{headerItemElement:t,width:isNaN(i)?await t.getMinWidth():i}})))&&void 0!==i?i:[];this.headerItemElementsWidth=await Promise.all(s).then((t=>t.reduce(((t,i)=>t.set(i.headerItemElement,i.width)),new Map)))}getStickyColumnsWidth(){var t,i;const s=b(this.self)?w:0,e=this.selectionenabled?g:0;return(null===(i=null===(t=this.headerItemElements)||void 0===t?void 0:t.filter((t=>"sticky"===t.slot)))||void 0===i?void 0:i.reduce(((t,i)=>{var s;return null!==(s=t+this.headerItemElementsWidth.get(i))&&void 0!==s?s:0}),0))+s+e}getScrollWidth(){var t,i;const s=b(this.self)?w:0,e=this.selectionenabled?g:0;return(null!==(i=null===(t=this.headerItemElements)||void 0===t?void 0:t.reduce(((t,i)=>{var s;return null!==(s=t+this.headerItemElementsWidth.get(i))&&void 0!==s?s:0}),0))&&void 0!==i?i:0)+s+e}setScrollContainer(t){var i,s;this.scrollContainer!==t&&(null===(i=this.scrollContainer)||void 0===i||i.removeEventListener("scroll",this.scrollHandler),this.scrollContainer=t,null===(s=this.scrollContainer)||void 0===s||s.addEventListener("scroll",this.scrollHandler))}async updateTableScroll(t){var i;if(!this.scrollable)return;if(null==this.headerItemElements||0===this.headerItemElements.length)return;const s=b(this.self)?w:0,e=this.selectionenabled?g:0;await Promise.all(null===(i=this.headerItemElements)||void 0===i?void 0:i.map((t=>t.getMinWidth()))).then((i=>{var n;const o=(null!==(n=null==i?void 0:i.reduce(((t,i)=>(isNaN(i)&&console.error("dx-table:",this.self,"Every <dx-table-header-item> in a scrollable table has to set a minwidth. At least one <dx-table-header-item> was not given a size."),t+i)),0))&&void 0!==n?n:0)+e+s>t;this.internalScrollable!==o&&(this.internalScrollable=o,this.updateCellSettings().then(),o||(this.showLeftShadow=!1,this.showRightShadow=!1))}))}controlOpticalHints(){if(!this.internalScrollable||null==this.scrollContainer)return;const t=this.scrollContainer.scrollLeft,i=this.scrollContainer.scrollWidth-this.scrollContainer.clientWidth;e((()=>{var s;this.showRightShadow=t<i,this.showLeftShadow=this.isScrollingPossible()&&(null===(s=this.scrollContainer)||void 0===s?void 0:s.scrollLeft)>0}))}isScrollingPossible(){var t,i;return this.internalScrollable&&(null===(t=this.scrollContainer)||void 0===t?void 0:t.scrollWidth)>(null===(i=this.scrollContainer)||void 0===i?void 0:i.clientWidth)}async invokeSort(t,i){if(this.initialized)return this.internalInvokeSort(t,i);this.invokeSortInputParamsBeforeInit={element:t,reverse:i}}async internalInvokeSort(t,i){var s;const e=this.headerItemElements.indexOf(t);this.headerItemElements.forEach(((t,i)=>{e!==i&&t.setSortDirection("neutral")})),this.sortState={column:null!==(s=t.columnid)&&void 0!==s?s:t.label,index:e,direction:i?"desc":"asc"},this.sortRows({column:e,reverse:i})}reSort(){null!==this.currentSortSettings.column&&this.sortRows(this.currentSortSettings)}handlePaginationPageSizeChanged(t){this.pagesize=t.detail,this.emitTableStateChanged(),this.updateVisibility()}isUsingPagination(){return null!=this.pagesizes&&this.pagesizes.length>0}updateRows(t){this.rowDebounce.run((async()=>{this.mutationObserver.disconnect(),this.checkForDuplicateRowKeys(t),this.handleRemoteSelection(t),h(t,this.rowElements)?n(this.self):(this.rowElements=t,"managed"===this.mode&&(this.rowcount=t.length,x(this.headerItemElements)?this.reSort():await this.reOrderRows(this.rowElements))),await this.updateVisibility(),await this.updateCellSettings(),this.mutationObserver.observe(this.self,{childList:!0,subtree:!0,attributes:!0}),this.init()}))}handleRemoteSelection(t){requestAnimationFrame((()=>{var i;const s=[...this.selectedRowKeys];if("single"===this.selectionmode){const s=this.selectedRowKeys[0],e=null===(i=t.filter((t=>1==t.selected)).filter((t=>t.rowid!==s))[0])||void 0===i?void 0:i.rowid;if(null==e)return;this.selectionenabled=!0,this.handleRadioSelection(e)}else t.forEach((t=>{this.selectionenabled||(this.selectionenabled=t.selected),this.handleCheckboxSelection(t.rowid,t.selected)}));h(s,this.selectedRowKeys)||this.rowsSelected.emit([...this.selectedRowKeys])}))}init(){this.initialized=!0,null!=this.invokeSortInputParamsBeforeInit&&(this.internalInvokeSort(this.invokeSortInputParamsBeforeInit.element,this.invokeSortInputParamsBeforeInit.reverse).then(),this.invokeSortInputParamsBeforeInit=null)}getCurrentRowsRangeIndices(){var t,i;const s=(null!==(t=this.pagesize)&&void 0!==t?t:0)*(this.currentPage-1),e={fromIndex:s,toIndex:s};return e.toIndex+="managed"===this.mode?(null!==(i=this.pagesize)&&void 0!==i?i:this.rowcount)-1:this.pagesize-1,e.toIndex=Math.min(this.rowcount-1,e.toIndex),e}emitTableStateChanged(){const t=this.getCurrentRowsRangeIndices();this.tableStateChanged.emit({page:this.currentPage,pageSize:this.pagesize,fromIndex:t.fromIndex,toIndex:t.toIndex,sortState:this.sortState})}async updateHeaderItems(t){var i,e;const n=await Promise.all(t.map((t=>t.toColumnSettings())));if(this.sameSettings(n)&&d(this.headerItemElements,t))return;this.settings=n;const o=x(this.headerItemElements);if(this.headerItemElements=t,!o){const s=null==t?void 0:t.filter((t=>t.sortable));let n=null;(null===(i=this.initialsort)||void 0===i?void 0:i.length)>0&&(n=null==s?void 0:s.find((t=>t.columnid===this.initialsort||t.label===this.initialsort)),c(null!=n,(()=>`No <dx-table-header-item> element with 'columnid' or 'label' "${this.initialsort}" found`))),null!=n||(n=null==s?void 0:s[0]),null==n||n.setSortDirection(null!==(e=this.initialsortdirection)&&void 0!==e?e:"asc")}s((()=>{const t=this.self.shadowRoot.querySelector(".table");null!=t&&v(this.updateTableScroll(t.getBoundingClientRect().width)),this.updateCellSettings().then()}))}sameSettings(t){return null!=this.settings&&this.settings.length===t.length&&t.every(((t,i)=>{return(null==(s=t)?void 0:s.type)===(null==(e=this.settings[i])?void 0:e.type)&&(null==s?void 0:s.align)===(null==e?void 0:e.align)&&(null==s?void 0:s.lines)===(null==e?void 0:e.lines)&&JSON.stringify(null==s?void 0:s.sizeStyle)==JSON.stringify(null==e?void 0:e.sizeStyle);var s,e}))}async updateCellSettings(){var t;return null===(t=this.headerItemElements)||void 0===t||t.forEach((t=>{t.usemaxwidth=this.internalScrollable})),Promise.all(this.getRows().concat(this.getFooters()).flatMap((t=>Array.from(t.querySelectorAll("dx-table-cell")).map(((t,i)=>{var s;return i<(null===(s=this.headerItemElements)||void 0===s?void 0:s.length)?t.obtainSettings(this.settings[i]):null})).filter((t=>null!=t)))))}getRows(){var t;return null!==(t=this.rowElements)&&void 0!==t?t:[]}getFooters(){var t;return null!==(t=Array.from(this.self.querySelectorAll("dx-table-footer")))&&void 0!==t?t:[]}compareColumns(t,i,s,e){var n;const o="dx-table-cell:nth-child("+(s+1)+")";if("html"===e){const e=this.headerItemElements[s];return null!=e.customSort?e.customSort(t.querySelector(o),i.querySelector(o)):0}const l=t.querySelector(o).getAttribute("value"),a=i.querySelector(o).getAttribute("value");return"numeric"===e||"currency"===e?parseFloat(l)-parseFloat(a):null!==(n=null==l?void 0:l.localeCompare(a))&&void 0!==n?n:a?-1:0}sortRows(t){var i,s;((i=this.currentSortSettings).column!==(s=t).column||i.reverse!==s.reverse)&&(this.currentPage=1,this.emitTableStateChanged()),"remote"!==this.mode&&(this.currentSortSettings.column=t.column,this.currentSortSettings.reverse=t.reverse,this.sortDebounce.run((async()=>{var i,s;const e=[...null!==(i=this.getRows())&&void 0!==i?i:[]],n=null===(s=this.settings[t.column])||void 0===s?void 0:s.type,o=t.reverse?-1:1,l=this.headerItemElements.filter(((i,s)=>s!==t.column)).filter((t=>t.sortable&&null!=t.sortpriority)).sort(((t,i)=>i.sortpriority-t.sortpriority)).map((t=>this.headerItemElements.indexOf(t)));e.sort(((i,s)=>{var e;let a=t.column,r=n;const h=[...l];let d=this.compareColumns(i,s,a,r)*o;for(;0===d&&h.length>0;)a=h.pop(),r=null===(e=this.settings[a])||void 0===e?void 0:e.type,d=this.compareColumns(i,s,a,r);return d})),await this.reOrderRows(e),this.updateVisibility()})))}checkForDuplicateRowKeys(t){const i=t.reduce(((t,i)=>{var s,e;return null!=i.rowid&&(t[i.rowid]=null!==(e=null===(s=t[i.rowid])||void 0===s?void 0:s.concat(i))&&void 0!==e?e:[i]),t}),{});Object.keys(i).forEach((t=>{const s=i[t];s.length>1&&console.error(`Duplicate key "${t}" in rows:\n`,...s)}))}async reOrderRows(t){return new Promise((i=>{e((()=>{t.forEach(((t,i)=>{t.style.order=(i+1).toString()})),i()}))}))}async updateVisibility(){const t=this.getRows();if("managed"===this.mode&&this.isUsingPagination()){const i=this.getCurrentRowsRangeIndices();await new Promise((n=>{s((()=>{const s=t.map((t=>{const s=parseInt(t.style.order)-1;return s>=i.fromIndex&&s<=i.toIndex}));e((()=>{t.forEach(((t,i)=>{t.setAttribute("visible",s[i].toString())})),n()}))}))}))}const i=this.getLastVisibleRow();null!=i&&i.style.setProperty(m,"none"),t.forEach((t=>{i===t||t.style.removeProperty(m)}))}getLastVisibleRow(t){return(null!=t?t:this.getRows()).filter((t=>t.visible)).reduce(((t,i)=>{const s=parseInt(i.style.order);return s>t.order||-1===t.order||isNaN(t.order)?{order:s,row:i}:t}),{order:-1,row:null}).row}handlePaginationPageChanged(t){const i=t.detail;this.currentPage!==i&&(this.currentPage=i,this.emitTableStateChanged(),this.updateVisibility())}handleRadioSelection(t){this.selectedRowKeys[0]!==t&&(this.selectedRowKeys=[t],this.rowElements.forEach((t=>{t.selected=t.rowid==this.selectedRowKeys[0]})))}handleCheckboxSelection(t,i){const s=this.selectedRowKeys.includes(t);s&&!i?this.selectedRowKeys=this.selectedRowKeys.filter((i=>i!==t)):!s&&i&&(this.selectedRowKeys=[...this.selectedRowKeys,t])}componentDidRender(){this.controlOpticalHints(),"single"===this.selectionmode&&(this.selectionGroup.value=this.selectedRowKeys[0])}async componentWillRender(){await this.updateTableHeaderWidths()}render(){return o(l,{role:"table",style:{"--dx-internal-table-sticky-columns-width":this.getStickyColumnsWidth().toString()+"px","--dx-table-selection-column-width":this.selectionenabled?`${g}px`:"0px","--dx-table-expansion-column-width":this.expansionEnabled?`${w}px`:"0px"}},this.renderPageSizePicker(),o("dx-radio-button-group",{radiogroupid:"table-selection-group",ref:t=>{this.selectionGroup=t}},o("div",{class:"table-container"},this.renderTable())),this.renderPaginator())}renderPageSizePicker(){if(this.isUsingPagination())return o("dx-number-picker",{id:u.createId(this.self,"page-size-picker"),align:"right",class:"page-size-picker",value:this.pagesize,values:this.pagesizes,onValueChange:t=>this.handlePaginationPageSizeChanged(t)})}renderPaginator(){if(this.isUsingPagination())return o("div",{class:"paginator-container"},o("dx-number-paginator",{id:u.createId(this.self,"paginator"),class:"paginator",onPageChanged:t=>this.handlePaginationPageChanged(t),current:this.currentPage,count:Math.ceil(this.rowcount/this.pagesize)}))}renderScrollableTableContent(){return o("div",null,o("ds-scroll-container",{scrollbarborderradius:0,thumbwidth:8,scrollbaroffset:4},o("div",{ref:t=>{e((()=>{this.setScrollContainer(t)}))},class:{scrollable:!0},style:{"--dx-table-row-width":this.internalScrollable?`${this.getScrollWidth()}px`:"none"}},o("slot",null))))}renderTable(){const t=b(this.self);return[o("div",{class:{table:!0,"with-collapse-rows":t,"selection-enabled":this.selectionenabled},ref:t=>{var i;null===(i=this.tableResizeObserver)||void 0===i||i.observe(t)}},this.internalScrollable?this.renderScrollableTableContent():o("slot",null),o("div",{class:{shadow:!0,left:!0,show:this.showLeftShadow}}," "),o("div",{class:{shadow:!0,right:!0,show:this.showRightShadow}}," "))]}get self(){return a(this)}static get watchers(){return{internalScrollable:["onInternalScrollableChanged"],selectionenabled:["onSideBarOpenChange"],selectionmode:["onSelectionModeChanged"],scrollable:["onScrollableChange"]}}},m="--dx-table-row-border-bottom";function x(t){return null==t?void 0:t.some((t=>t.sortable))}const w=64,g=56;p.style="@keyframes slide-left{0%{transform:translateX(0)}100%{transform:translateX(-10px)}}:host{width:100%;--dx-table-sticky-columns-width:calc(var(--dx-table-selection-column-width, 0px) + var(--dx-table-expansion-column-width, 0px))}:host:host([hidden]){display:none !important}@media (min-width: 760px){:host{--dx-table-sticky-columns-width:var(--dx-internal-table-sticky-columns-width, 0)}}:host .page-size-picker{margin-bottom:12px}:host .table-container{display:flex}:host .table-container.uses-pagination{margin-bottom:16px}:host .table-container .table{display:flex;width:100%;overflow:hidden;flex-direction:column;position:relative}:host .table-container .table.selection-enabled{--dx-table-selection-display:flex}:host .table-container .table.with-collapse-rows{--dx-table-expand-display:flex}:host .table-container .table .scrollable{position:relative;overflow-x:auto;display:flex;flex-direction:column;margin-bottom:8px;min-width:100%;--dx-table-row-overflow:visible}:host .table-container .table .scrollable::-webkit-scrollbar{display:none}:host .table-container .table .shadow{position:absolute;top:0;width:0;background-color:rgba(0, 0, 0, 0.03);z-index:1;height:calc(100% - 8px);transition:width 300ms ease-in-out}:host .table-container .table .shadow.left{left:var(--dx-table-sticky-columns-width)}:host .table-container .table .shadow.right{right:0}:host .table-container .table .shadow.show{width:4px}:host .table-container .table .shadow.show.left{border-left:1px solid #d6d6d6}:host .table-container .table .shadow.show.right{border-right:1px solid #d6d6d6}:host .table-container ds-scroll-container.table{overflow:visible}:host .table-container .over-last-border{position:absolute;background:white;bottom:0;height:1px;width:100%}:host .table-container .over-last-border.with-scrollbar-offset{bottom:8px}:host .table-container .footer{display:flex;justify-content:flex-end;padding:12px 24px}:host .paginator-container{display:flex;justify-content:flex-end;margin-top:16px}:host .paginator-container .paginator{flex:0 0 266px}@media (min-width: 476px){:host .paginator-container .paginator{flex:0 0 392px}}.sidebar-container{display:flex;flex-direction:row-reverse;position:relative;transition:transform 300ms ease-in-out, flex 300ms ease-in-out;will-change:flex;flex:0 0 0;height:max-content;overflow:hidden;z-index:2}.sidebar-container.open{flex:0 0 56px;transition:transform 300ms ease-in-out, flex 300ms ease-in-out}.sidebar-container.open .sidebar .row{align-items:center}.sidebar-container .sidebar{display:flex;flex-direction:column;flex:0 0 56px;width:56px}.sidebar-container .sidebar .header{border-bottom:1px solid #c8aa22;box-sizing:border-box}.sidebar-container .sidebar .row{display:none;box-sizing:border-box;border-bottom:1px solid #d6d6d6}.sidebar-container .sidebar .row.selected{background-color:#f7f7f7}.sidebar-container .sidebar .row.visible{display:block}.sidebar-container .sidebar .row.last-row{border-bottom:none}.sidebar-container .sidebar .row .selection-container{display:flex;height:64px;justify-content:center;align-items:center}.sidebar-container .sidebar .footer{margin-top:4px;background-color:#e4ebcc}";export{p as dx_table}