import{r as e,c as t,f as i,a as n,w as s,h as l,H as a,g as o}from"./p-c66bef8d.js";import{c as r}from"./p-968cb048.js";import{n as h}from"./p-fabbcf47.js";import{n as d,t as x,a as c,P as p,b as m,d as g}from"./p-e0194d22.js";import{C as u}from"./p-e5e316fc.js";import{a as b}from"./p-dc250dcd.js";import{D as f}from"./p-54eaab21.js";import{B as w}from"./p-76fa4815.js";import{P as v}from"./p-602d2bf7.js";import{o as y}from"./p-90458c1b.js";const z=class{constructor(i){e(this,i),this.segmentSelect=t(this,"segmentSelect",7),this.donutRadius=15.915,this.viewBoxSize=3*this.donutRadius,this.virtualScaledSegmentWidth=31.25,this.labelPositioningFactor=1.75,this.debounce=new f(200),this.mouseMoveHandler=e=>{this.handleMouseMove(e)},this.chartInput=[],this.internalSelected=null,this.selected=null,this.colorscheme="custom",this.showsegmentlabels=!1}onShowSegmentLabelsChanged(){this.showsegmentlabels&&y((()=>this.startUpdateCalculation()))}connectedCallback(){this.breakpointAware=new w((()=>null),!0)}disconnectedCallback(){var e,t,i;null===(e=this.debounce)||void 0===e||e.reset(),null===(t=this.breakpointAware)||void 0===t||t.disconnect(),null===(i=this.slotObserver)||void 0===i||i.disconnect()}onWindowResizeChange(){this.startUpdateCalculation()}async update(){this.startUpdateCalculation().then((()=>{i(this)}))}async startUpdateCalculation(){return new Promise((e=>{n((()=>{const t=this.self.shadowRoot.querySelectorAll(".segment-label, .label-line"),i=e=>{s((()=>{null==t||t.forEach((t=>{e?t.classList.add("visible"):t.classList.remove("visible")}))}))};i(!1),this.debounce.run((async()=>{await this.updatePositions(),i(!0),e()}))}))}))}async updatePositions(){if(!this.showsegmentlabels||0===this.chartInput.length)return;const e=this.generateDonutCreateData();return new Promise((t=>{n((()=>{const i=Array.from(this.self.shadowRoot.querySelectorAll(".label-line")),n=Array.from(this.self.shadowRoot.querySelectorAll(".segment-label"));let l=e.segments[e.segments.length-1].input.value/e.sum,a=0,o=0;const r=this.self.offsetWidth,h=this.breakpointAware.mq1?2:1,x=function(e){let t=0,i=0===e[e.length-1].offset;const n=e=>Math.abs(e)<k;return e.map(((s,l)=>{var a,o;const r=n(s.offset);if(i||r){const i=e.slice(l+1),s=i.findIndex((e=>n(e.offset)));t=null!==(o=null===(a=i[(-1===s?i.length:s)-1])||void 0===a?void 0:a.offset)&&void 0!==o?o:0}return i=r,Object.assign(Object.assign({},s),{offset:s.offset-.5*t})}))}(e.segments.map((t=>{const n=t.input.value/e.sum,{distance:s,offset:d}=function(e,t,i,n,s,l){const a=s*function(e,t,i){const n=S(t,20),s=S(i,20),l=Math.abs(t-i);return Math.pow((1-l)*n*s,Math.min(4/e+100*l,10))}(e.input.icon?1.3333:.75,i,n),o=2*S(i,10),r=t*(i>=.1?o:1)+a;return{distance:r,offset:n<.1||t>0?r*l:0}}(t,o,n,l,h,1+window.innerWidth/r*.5);return l=n,o=0===d?0:s,{segment:t,correspondingLabelLine:i[a++],offset:d}}))).map(((t,i)=>{const{segment:s,correspondingLabelLine:l,offset:a}=t,o=this.getSegmentMiddleDirectionFromOrigin(s,e.sum,a),r=this.getSegmentMiddleDirectionFromOrigin(s,e.sum),h=new p(.5*this.viewBoxSize),x=this.viewBoxSize*this.labelPositioningFactor,c=h.plus(o.scale(.53*x)),m=h.plus(r.scale(.485*x)),u=c.minus(m),b=m.plus(u.scale(.9)),f=d(u),w=h.minus(c),y=50-w.x,z=50+w.y,S=h.minus(m),j=h.minus(b),M=50-S.x,C=50+S.y,L=50-j.x,$=50+j.y;return()=>{null!=l&&(new v(l).set("can-be-visible",s.input.value/e.sum<.1||Math.abs(a)>k).execute(),l.setAttribute("x1",`${M}%`),l.setAttribute("y1",`${C}%`),l.setAttribute("x2",`${L}%`),l.setAttribute("y2",`${$}%`)),n[i].style.setProperty("top",`${z}%`),n[i].style.setProperty("left",`${y}%`);const t=g(f),o=Math.sin(t),r=Math.cos(t);n[i].style.setProperty("transform",`translate(${50*(o-1)}%, ${-50*(r+1)}%)`)}}));s((()=>{x.forEach((e=>e())),t()}))}))}))}componentDidLoad(){this.slotObserver=r(this.self,h("dx-chart-sample"),(async e=>{await this.collectSamplesFromChildren(e),requestAnimationFrame((()=>{this.startUpdateCalculation()}))}))}async collectSamplesFromChildren(e){this.chartInput=await Promise.all(e.map((e=>e.toChartSample()))),b(this.chartInput.length>=2&&this.chartInput.length<=8,(()=>"A donut chart should contain 2 to 8 samples!"),this.self)}getHitAngle(e,t){const i=this.self.getBoundingClientRect(),n=new p(.5*i.width,.5*i.height).plus(x(i)),s=new p(e,t),l=this.getScaledOuterDiameter/i.width,a=s.minus(n).scale(l),o=a.lengthSquared,r=this.getScaledOuterRadius(),h=r-2*this.virtualScaledSegmentWidth;if(o>=h*h&&o<=r*r){let e=180*Math.acos(a.x/Math.sqrt(o))/m;return s.y<n.y&&(e=360-e),(e+90+360)%360}return null}getSegmentIndexOnCoordinate(e,t){const i=this.getHitAngle(e,t);return this.getSelectIndexWithAngle(i)}handleMouseMove(e){const t=this.getHitAngle(e.clientX,e.clientY);null!=t?this.selectSegmentByAngle(t):this.selectSegment(null)}getSelectIndexWithAngle(e){const t=this.chartInput.map((e=>e.value)).reduce(((e,t)=>e+t),0);let i=0;return this.chartInput.findIndex((n=>{const s=i;return i+=n.value,e>=s/t*360&&e<=i/t*360}))}selectSegmentByAngle(e){const t=this.getSelectIndexWithAngle(e);-1!==t&&this.selectSegment(t)}selectSegment(e){this.internalSelected!==e&&(this.internalSelected=e,this.segmentSelect.emit(e))}generateDonutCreateData(){return this.chartInput.reduce(((e,t,i)=>({segments:[...e.segments,{input:t,offset:0==i?0:e.segments[i-1].offset+e.segments[i-1].input.value}],sum:e.sum+t.value})),{segments:[],sum:0})}get getScaledOuterDiameter(){return 2*this.getScaledOuterRadius()}getScaledOuterRadius(){return 100+.5*this.virtualScaledSegmentWidth}getSegmentMiddleDirectionFromOrigin(e,t,i=0){return c((.5*(e.offset+(e.offset+e.input.value))+i)/t*360)}getSegmentEndDirectionFromOrigin(e,t){return c((e.offset+e.input.value)/t*360)}getColor(e,t){return new u(!0).getColorCode((()=>{var i;switch(this.colorscheme){case"blue":return t?"blue-100":"blue-60";case"gray":return t?"gray-66":"gray-33";case"signal":const n=e.input.color;if(["green","orange","red","success","warning","error"].includes(n)){const e=null!==(i={success:"green",warning:"orange",error:"red"}[n])&&void 0!==i?i:n;return t?`${e}-100`:`${e}-60`}return t?"red-100":"red-60";case"custom":return t?e.input.selectedcolor:e.input.color}})())}handlePointerEnter(e){"mouse"===e.pointerType&&window.addEventListener("mousemove",this.mouseMoveHandler)}handlePointerLeave(e){"mouse"===e.pointerType&&(this.selectSegment(null),window.removeEventListener("mousemove",this.mouseMoveHandler))}handlePointerUp(e){if("mouse"===e.pointerType)return;const t=this.getSegmentIndexOnCoordinate(e.clientX,e.clientY);this.selectSegment(this.internalSelected===t?null:t)}renderLineFromDirectionVector(e,t){var i;return l("line",{x1:e.x,y1:e.y,x2:e.x+t.x,y2:e.y+t.y,"stroke-width":null!==(i=window.offsetValue)&&void 0!==i?i:1,stroke:"black"})}renderCircleSegment(e,t,i){var n,s;const a=100*e.input.value/t;return l("circle",{class:"segment",cx:.5*this.viewBoxSize,cy:.5*this.viewBoxSize,r:"15.915",fill:"transparent","stroke-dasharray":`${a} ${100-a}`,"stroke-dashoffset":25-100*e.offset/t,"stroke-width":i?null!==(n=window.selectedStrokeWidthValue)&&void 0!==n?n:"6.25":null!==(s=window.strokeWidthValue)&&void 0!==s?s:"5",stroke:this.getColor(e,i),mask:"url(#segment-offset)"})}renderSegmentMask(e){const t=e.segments;return l("mask",{id:"segment-offset"},l("rect",{width:"100%",height:"100%",fill:"white"}),t.map((t=>{const i=this.getSegmentEndDirectionFromOrigin(t,e.sum),n=2*this.donutRadius;return this.renderLineFromDirectionVector(new p(.5*this.viewBoxSize),new p(i.x*n,i.y*-n))})))}renderLabelLine(){if(this.showsegmentlabels)return l("line",{class:"label-line"})}renderCircleSegments(e){return[l("svg",{viewBox:`0 0 ${this.viewBoxSize} ${this.viewBoxSize}`},l("defs",null,this.renderSegmentMask(e)),e.segments.map(((t,i)=>this.renderCircleSegment(t,e.sum,null==this.internalSelected&&i===this.selected||i===this.internalSelected)))),l("svg",{class:"label-svg"},e.segments.map((()=>this.renderLabelLine())))]}renderSegmentLabels(e){if(this.showsegmentlabels)return e.segments.map((e=>l("div",{class:"segment-label can-be-visible"},e.input.icon&&l("dx-icon",{color:"paragraph",icon:e.input.icon}),l("dx-text",{color:"paragraph"},e.input.label))))}renderLabels(e){var t,i;return l("div",{class:"overlay"},l("div",{class:"inner-labels"},(null===(t=this.label)||void 0===t?void 0:t.length)>0?l("dx-text",{class:"label"},this.label):null,(null===(i=this.sublabel)||void 0===i?void 0:i.length)>0?l("dx-text",{class:"sub-label"},this.sublabel):null),this.renderSegmentLabels(e))}render(){const e=this.generateDonutCreateData();return l(a,{style:{"user-select":"none"},onContextMenu:()=>!1,onPointerEnter:e=>this.handlePointerEnter(e),onPointerLeave:e=>this.handlePointerLeave(e),onPointerUp:e=>this.handlePointerUp(e)},l("div",{class:"donut-container"},this.renderCircleSegments(e),this.renderLabels(e)))}get self(){return o(this)}static get watchers(){return{showsegmentlabels:["onShowSegmentLabelsChanged"]}}};function S(e,t){return Math.pow(1.01-e,t)}const k=1e-4;z.style=":host{display:block;width:100%}:host:host([hidden]){display:none !important}.donut-container{display:grid;aspect-ratio:1;position:relative}.content-container{display:flex;justify-content:center;align-items:center;position:absolute;top:25%;left:25%;width:50%;height:50%;margin:auto}.label-svg{position:absolute;top:0;left:0;width:100%;height:100%}.label-line{stroke:#575757;opacity:0}.sub-label,.label-svg,.segment-label{white-space:nowrap;--dx-text-color:#575757}@media (min-width: 0px) and (min-width: 0px){.sub-label,.label-svg,.segment-label{font-size:12px;--dx-text-font-size:12px;line-height:16px;--dx-text-line-height:16px}}@media (min-width: 0px) and (min-width: 1280px){.sub-label,.label-svg,.segment-label{font-size:14px;--dx-text-font-size:14px;line-height:20px;--dx-text-line-height:20px}}@media (min-width: 1024px) and (min-width: 0px){.sub-label,.label-svg,.segment-label{font-size:20px;--dx-text-font-size:20px;line-height:28px;--dx-text-line-height:28px}}@media (min-width: 1024px) and (min-width: 1280px){.sub-label,.label-svg,.segment-label{font-size:22px;--dx-text-font-size:22px;line-height:32px;--dx-text-line-height:32px}}@media (min-width: 1280px) and (min-width: 0px){.sub-label,.label-svg,.segment-label{font-size:22px;--dx-text-font-size:22px;line-height:32px;--dx-text-line-height:32px}}@media (min-width: 1280px) and (min-width: 1280px){.sub-label,.label-svg,.segment-label{font-size:26px;--dx-text-font-size:26px;line-height:36px;--dx-text-line-height:36px}}.segment{transition:stroke, stroke-width;transition-duration:300ms;transition-timing-function:ease-in-out}.text{font-family:DVAG-Type, sans-serif;fill:#575757}.segment-label,.label-line{transition:opacity 150ms ease-in-out;opacity:0}.segment-label.can-be-visible.visible,.label-line.can-be-visible.visible{opacity:1}.overlay{position:absolute;display:flex;justify-content:center;align-items:center;width:100%;height:100%;top:0;left:0}.overlay .inner-labels{display:flex;flex-direction:column;justify-content:center;align-items:center;width:50%;height:50%;top:25%;left:25%;text-align:center}.overlay .label{--dx-text-color:#2b2b2b}@media (min-width: 0px) and (min-width: 0px){.overlay .label{font-size:16px;--dx-text-font-size:16px;line-height:24px;--dx-text-line-height:24px}}@media (min-width: 0px) and (min-width: 1280px){.overlay .label{font-size:18px;--dx-text-font-size:18px;line-height:28px;--dx-text-line-height:28px}}@media (min-width: 1024px) and (min-width: 0px){.overlay .label{font-size:30px;--dx-text-font-size:30px;line-height:40px;--dx-text-line-height:40px}}@media (min-width: 1024px) and (min-width: 1280px){.overlay .label{font-size:38px;--dx-text-font-size:38px;line-height:48px;--dx-text-line-height:48px}}@media (min-width: 1280px) and (min-width: 0px){.overlay .label{font-size:34px;--dx-text-font-size:34px;line-height:44px;--dx-text-line-height:44px}}@media (min-width: 1280px) and (min-width: 1280px){.overlay .label{font-size:46px;--dx-text-font-size:46px;line-height:56px;--dx-text-line-height:56px}}.overlay .label+.sub-label{margin-top:8px}.overlay .segment-label{position:absolute;transform:translate(-50%, -50%);display:flex;align-items:center}@media (min-width: 0px){.overlay .segment-label{--dx-icon-attr-size:16px}}@media (min-width: 1024px){.overlay .segment-label{--dx-icon-attr-size:24px}}@media (min-width: 1280px){.overlay .segment-label{--dx-icon-attr-size:32px}}.overlay .segment-label dx-icon{margin-right:8px}";export{z as dx_donut_chart}