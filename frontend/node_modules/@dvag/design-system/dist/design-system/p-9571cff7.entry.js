import{r as t,c as i,f as s,h as e,H as o,g as n}from"./p-c66bef8d.js";import{v as l,E as h}from"./p-70f48e14.js";import{c as r}from"./p-968cb048.js";import{f as a}from"./p-9e335670.js";import{a as d}from"./p-dc250dcd.js";import{o as p}from"./p-90458c1b.js";import{R as u}from"./p-4de2e84c.js";import{h as c,a as b}from"./p-aa0a06c6.js";import{I as m}from"./p-38e28938.js";import{E as f}from"./p-3f966ea5.js";import{c as v}from"./p-7ac64225.js";import"./p-15b13381.js";import"./p-fabbcf47.js";const x=class{constructor(s){t(this,s),this.valueChange=i(this,"valueChange",7),this.valueComplete=i(this,"valueComplete",7),this.lastEmittedChangeValue=null,this.lastEmittedCompleteValue=null,this.preventReFocus=!1,this.selectScanningEnabled=!0,this.options=[],this.inputFocused=!1,this.listOpen=!1,this.internalValue=null,this.showMouseHoverEffectOnList=!0,this.error=!1,this.readonly=!1,this.required=!1,this.placeholder="Bitte wÃ¤hlen",this.value=null,this.textalign="left",this.popupposition="bottom",this.elseoption=!1,this.elseoptionbuttonlabel="Sonstige Eingabe",this.elseoptioninputlabel="Sonstige Eingabe",this.elseoptionselected=!1,this.disabled=!1,this.kisynced=!1}valueChanged(){this.obtainValueChangesFromOutside()}async focusControl(){this.inputElement.focus()}componentWillLoad(){l(this.self),this.obtainValueChangesFromOutside(!0)}connectedCallback(){this.optionsObserver=r(this.self,"ds-dropdown-option",(async t=>{await this.collectOptions(t),this.findSelectedOption();const i=a(this.options);d(0==i.length,(()=>`Innerhalb eines DsDropdowns sollten kein Eintrag mit denselben values existieren!\nFolgende duplizierte Values wurden gefunden: ${i.join()}`))}))}disconnectedCallback(){var t;null===(t=this.optionsObserver)||void 0===t||t.disconnect(),clearInterval(this.observeSelectElementIntervalHandle)}componentDidRender(){this.listOpen&&null!=this.selectedOption&&this.scrollIntoView(this.selectedOption)}findSelectedOption(){if(this.self.querySelectorAll("ds-dropdown-option").length!==this.options.length)return;const t=this.options.find((t=>t.value===this.value));this.elseoptionselected||null==t?this.elseoption&&null!==this.internalValue?(this.elseoptionselected=!0,this.selectedOption=null):(this.selectedOption=null,this.elseoptionselected=!1):null!=this.selectedOption&&v(t,this.selectedOption)||(this.selectedOption=t)}async collectOptions(t){const i=this.options;this.options=await Promise.all(t.map((t=>t.toOption()))),this.options.length>0&&i.length>0&&this.findSelectedOption()}updateInternalValue(t){this.internalValue=t,this.nativeSelect&&(this.nativeSelect.value=JSON.stringify(this.internalValue))}obtainValueChangesFromOutside(t=!1){this.sanitizeValue(),(t||this.value!==this.internalValue)&&(this.updateInternalValue(this.value),this.lastEmittedChangeValue=this.value,this.lastEmittedCompleteValue=this.value,this.findSelectedOption())}sanitizeValue(){void 0!==this.value&&this.value!==g||(this.value=null)}onInputFocused(){this.inputFocused=!0}onInputBlurred(){p((()=>{this.preventReFocus||!b(this.self)?(this.inputFocused=!1,this.setOpenListStatus(!1),this.emitValueChange(),this.emitValueComplete()):this.inputElement.focus(),this.preventReFocus=!1}))}toggleList(){this.setOpenListStatus(!this.listOpen)}onInputKeyUp(t){this.handleUpAndDownNavigation(t)||["Enter","Escape"].includes(t.code)&&(this.setOpenListStatus(!1),this.emitValueComplete())}onInputKeyDown(t){["ArrowDown","ArrowUp"].includes(t.code)&&t.preventDefault()}onInputClicked(){this.disabled||this.toggleList()}setOpenListStatus(t){this.listOpen=t,s(this),this.listOpen&&this.inputElement.focus()}selectOptionsByValue(t){if(t===g||""===t)null!==this.internalValue&&(this.selectedOption=null,this.updateInternalValue(null),this.emitValueChange());else{const i=this.options.find((i=>JSON.stringify(i.value)===t));null!=i?(this.selectedOption=i,this.updateInternalValue(this.selectedOption.value),this.elseoptionselected=!1,this.emitValueChange()):this.updateInternalValue(this.internalValue)}}requestElseOption(){this.elseoptionselected=!0,this.selectedOption=null,this.updateInternalValue(""),p((()=>{var t;null===(t=this.elseOptionInput)||void 0===t||t.focusControl()}))}selectValueFromElseOption(t){this.updateInternalValue(t),this.emitValueChange()}handleUpAndDownNavigation(t){if(["ArrowDown","ArrowUp"].includes(t.code)){const i=this.options.findIndex((t=>{var i;return t.value===(null===(i=this.selectedOption)||void 0===i?void 0:i.value)}));return"ArrowDown"==t.code&&this.selectOption(-1===i||i===this.options.length-1?this.options[0]:this.options[i+1]),"ArrowUp"==t.code&&this.selectOption(-1===i||0===i?this.options[this.options.length-1]:this.options[i-1]),this.showMouseHoverEffectOnList=!1,this.setOpenListStatus(!0),t.preventDefault(),t.stopImmediatePropagation(),!0}return!1}emitValueChange(){this.value=this.internalValue,this.lastEmittedChangeValue!==this.value&&(this.valueChange.emit(this.value),this.lastEmittedChangeValue=this.value)}emitValueComplete(){this.lastEmittedCompleteValue!==this.value&&(this.valueComplete.emit(this.value),this.lastEmittedCompleteValue=this.value)}selectOption(t){this.selectedOption=t,this.elseoptionselected=!1,this.updateInternalValue(this.selectedOption.value),this.emitValueChange(),this.scrollIntoView(this.selectedOption)}scrollIntoView(t){this.listOpen&&p((()=>{const i=this.options.findIndex((i=>i.value===(null==t?void 0:t.value)));if(i>-1){const t=this.self.shadowRoot.querySelector(".item-list-options");if(null==t)return;const s=Array.from(this.self.shadowRoot.querySelectorAll(".item-list .item"))[0].offsetHeight;t.scrollTop=s*i-t.offsetHeight/2+s/2}}))}superviseSelectElement(t){clearInterval(this.observeSelectElementIntervalHandle),this.nativeSelect=t,c(t,"value",(()=>{var i;!this.elseoptionselected&&this.selectScanningEnabled&&!this.readonly&&JSON.stringify(null!==(i=this.internalValue)&&void 0!==i?i:"null")!==t.value&&(()=>t.querySelectorAll("option").length>=this.options.length+1)()&&this.selectOptionsByValue(t.value)}))}valueMatchesOption(){var t,i;return(null===(i=null===(t=this.value)||void 0===t?void 0:t.toString())||void 0===i?void 0:i.length)>0&&null!=this.options.find((t=>t.value===this.value))}render(){var t,i,s,n;if(this.readonly)return e(u,{text:null!==(i=null===(t=this.selectedOption)||void 0===t?void 0:t.label)&&void 0!==i?i:"",label:this.label,kisynced:this.kisynced});const l=(null===(s=this.errormessage)||void 0===s?void 0:s.length)>0||this.error,r=this.valueMatchesOption()||this.elseoptionselected;return e(o,null,e("div",{class:{input:!0,disabled:this.disabled},ref:t=>this.inputElement=t,id:h.createId(this.self,"user-interaction"),tabIndex:this.disabled?-1:0,onKeyDown:t=>this.onInputKeyDown(t),onKeyUp:t=>this.onInputKeyUp(t),onFocus:()=>this.onInputFocused(),onBlur:()=>this.onInputBlurred(),onClick:()=>this.onInputClicked()}," ",e("ds-input-label",{disabled:this.disabled,label:this.label,kisynced:this.kisynced}),e("dx-overlay",{position:this.popupposition,offsety:4,disabled:!this.listOpen},e(m,{active:this.inputFocused,error:l,required:this.required&&!this.elseoptionselected,requirementFulfilled:r,disabled:this.disabled,title:null===(n=this.selectedOption)||void 0===n?void 0:n.label},this.renderNativeSelect(),this.renderCurrentValue(),this.renderOpenListButton(),e(f,{text:this.errormessage,show:!this.listOpen&&!this.elseoptionselected&&this.inputFocused})),this.renderItemList())),e("ds-required-hint",{required:this.required,fulfilled:r}),this.renderElseOptionInput())}renderNativeSelect(){let t=[{label:"-",value:g,icon:null},...this.options];return this.elseoptionselected&&(t=[{label:this.elseoptionbuttonlabel,value:"$$$ELSEOPTION$$$",icon:null},...t]),e("select",{id:h.createId(this.self,"control"),ref:t=>this.superviseSelectElement(t),tabIndex:-1,onChange:t=>{this.selectOptionsByValue(t.target.value)}},t.map((t=>e("option",{selected:t.value===this.internalValue||null===this.internalValue&&t.value===g,value:JSON.stringify(t.value)},t.label))))}renderOpenListButton(){return e("ds-function-icon-button",{id:h.createId(this.self,"open-list-button"),unfocusable:!0,class:{"open-list-button":!0}},e("ds-icon",{icon:"drop-down",size:16,class:{rotated:"top"===this.popupposition,disabled:!0===this.disabled}}))}renderItemList(){if(this.listOpen)return e("div",{slot:"overlay",onMouseMove:()=>this.showMouseHoverEffectOnList=!0,class:{"list-wrapper":!0,"list-open":this.listOpen,"enable-mouse-hover":this.showMouseHoverEffectOnList},tabIndex:-1},e("div",{class:"item-list"},e("div",{class:"item-list-options"},this.options.map((t=>this.renderOption(t)))),this.renderElseOptionButton()))}renderElseOptionButton(){if(this.elseoption&&!this.elseoptionselected)return e("div",{class:"else-option-button",onClick:()=>this.requestElseOption()},e("ds-text-button",{unfocusable:!0,id:h.createId(this.self,"else-option-button"),screensize:"small"},e("ds-text",null,this.elseoptionbuttonlabel)))}renderOption(t,i=!0,s=!1){var o,n;return e("div",{id:s?void 0:h.createId(this.self,`item-list-value-${t.value}`),class:{item:!0,"is-placeholder":s,right:"right"==this.textalign,selected:t.value==(null===(o=this.selectedOption)||void 0===o?void 0:o.value),disabled:!0===this.disabled},onClick:()=>{i&&(this.selectOption(t),this.inputElement.blur())}},(null===(n=t.icon)||void 0===n?void 0:n.length)>0?e("div",{class:{"icon-container":!0}},e("ds-icon",{size:24,icon:t.icon})):null,e("div",{class:{"labels-container":!0}},e("ds-text",{key:t.label,type:"ft",screensize:"small"},t.label),this.renderSubLabels(t,i,s)))}renderSubLabels(t,i,s){if(s||!i)return;const o=[];return t.secondaryLabel&&o.push(e("ds-text",{type:"it",screensize:"small"},t.secondaryLabel)),t.tertiaryLabel&&o.push(e("ds-text",{type:"itk",screensize:"small"},t.tertiaryLabel)),o}renderCurrentValue(){return e("div",{class:"current-value"},this.elseoptionselected?this.renderOption({label:this.elseoptionbuttonlabel,value:""},!1):null!=this.selectedOption?this.renderOption(this.selectedOption,!1):this.renderOption({label:this.placeholder,icon:this.icon,value:""},!1,!0))}renderElseOptionInput(){var t;if(this.elseoptionselected)return e("div",{class:"else-option-input-container"},e("ds-text-input",{ref:t=>this.elseOptionInput=t,id:h.createId(this.self,"else-option-input"),label:this.elseoptioninputlabel,value:this.internalValue,disabled:this.disabled,required:this.required,error:this.error||(null===(t=this.errormessage)||void 0===t?void 0:t.length)>0,errormessage:this.errormessage,onFocus:()=>{this.selectScanningEnabled=!1,this.preventReFocus=!0},onBlur:()=>{this.selectScanningEnabled=!0,this.preventReFocus=!1},onValueChange:t=>{this.selectValueFromElseOption(t.detail),t.stopPropagation()}}))}get self(){return n(this)}static get watchers(){return{value:["valueChanged"]}}},g="null";x.style=':host{display:block;min-width:0}:host:host([hidden]){display:none !important}:host:host([label]:not([label=""])){--ds-info-button-offset-y:24px}:host .input{outline:none;cursor:pointer;--dx-overlay-popup-min-width:unset}:host .input.disabled{cursor:default;pointer-events:none}:host .input .container{position:relative;top:0;left:0;display:flex;height:38px;border-radius:4px;border:1px solid #c1c1c1;background-color:#ffffff;box-sizing:border-box;align-items:center}:host .input .container.required-outline{border-color:#e8b50e}:host .input .container.requirement-fulfilled{border-color:#c1c1c1}:host .input .container.red-outline{border-color:#be1413}:host .input .container.disabled-outline{border-color:#ebebeb}:host .input .container.active{border-color:#4c4c4c}:host .input .container select{position:absolute;width:100%;left:0;top:0;pointer-events:none;opacity:0}:host .input .container .current-value{flex:1;overflow:hidden}:host .input .container .current-value .item{background:none}:host .input .container .current-value .item ds-text{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}:host .input .container .current-value .item.is-placeholder ds-text{color:#c1c1c1}:host .input .container .current-value .item.disabled{--ds-text-color:#dedede;--ds-icon-color:#dedede}:host .input .container .open-list-button{pointer-events:none}:host .input .container .open-list-button ds-icon.rotated{transform:scaleY(-1)}:host .input .container .open-list-button ds-icon.disabled{--ds-icon-color:#dedede}:host .input .list-wrapper{position:relative;bottom:0;top:0;width:100%}:host .input .list-wrapper:not(.list-open){position:fixed;top:-9999px;left:-9999px;visibility:hidden;pointer-events:none}:host .input .list-wrapper .item-list{width:100%;word-wrap:break-word;z-index:110;max-height:136.5px;border-radius:4px;box-shadow:0 4px 12px 0 rgba(0, 0, 0, 0.32);background-color:#ffffff;display:flex;flex-direction:column}@media (min-width: 768px){:host .input .list-wrapper .item-list{max-height:214.5px}}:host .input .list-wrapper .item-list .item-list-options{flex-grow:1;overflow-y:scroll}:host .input .list-wrapper .item-list .item-list-options .item{padding-right:10px}:host .input .list-wrapper .item-list .else-option-button{flex-shrink:0;height:38px;display:flex;justify-content:center;align-items:center;border-top:1px solid #dedede}:host .input .list-wrapper.position-top{top:0}:host .input .list-wrapper.position-top .item-list{bottom:5px}:host .input .list-wrapper .item.right{padding-right:10px}:host .item{user-select:none;-webkit-user-select:none;padding-left:10px;text-align:left;min-height:39px;display:flex;box-sizing:border-box;border-bottom:1px solid #dedede;padding-top:7px;padding-bottom:7px}:host .item .icon-container{flex:0 0 24px;height:24px}:host .item .labels-container{display:block;flex:1;overflow:hidden}:host .item .labels-container ds-text{display:block}:host .item ds-icon{flex-shrink:0}:host .item.selected{background-color:#f5f5f5}:host .item.right{text-align:right}:host .item ds-icon{margin-right:8px}:host .item:last-child{border-bottom:none}:host .enable-mouse-hover .item:hover{cursor:pointer;background-color:#f5f5f5}:host .else-option-input-container{margin-top:16px}';export{x as ds_dropdown}