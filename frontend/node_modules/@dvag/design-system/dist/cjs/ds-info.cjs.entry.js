'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

const index = require('./index-2f41386b.js');
const elementIdHandling = require('./element-id-handling-89898a1c.js');
const slotObserver = require('./slot-observer-2e83212e.js');
const renderUtil = require('./render-util-6b278c0d.js');
const miscUtil = require('./misc-util-63b423bd.js');
require('./value-store-f683b26f.js');
require('./query-util-8642f149.js');

const dsInfoCss = ":host{display:flex;position:relative;top:0;left:0}:host:host([hidden]){display:none !important}:host:host(.center-content){align-items:center}:host:host(.center-content) .info-container{height:24px}:host:host(:not(.center-content)) .info-container{padding-top:calc(var(--ds-info-button-offset-y, 0px) + 7px);padding-left:var(--ds-info-button-offset-x, 0px)}:host .info-container{position:relative;height:max-content;--dx-popup-offset-left:6px;--dx-popup-offset-top:1px}:host .info-container .info-button{width:fit-content;width:-moz-fit-content;cursor:pointer;display:inline-flex;justify-content:center;align-items:center;box-sizing:border-box;white-space:nowrap;user-select:none;-webkit-user-select:none;border-radius:6px;border:none;padding:0;margin:0;background-color:transparent;margin-left:8px;flex-shrink:0;cursor:pointer}:host .info-container .info-button:focus-visible{outline:none;box-shadow:var(--ds-button-outline-box-shadow, 0 0 0 2px #7f7f7f)}:host .info-container .info-button:hover{--ds-icon-color:#856d30}:host .info-container .info-button.hidden{pointer-events:none;visibility:hidden}:host .content{height:max-content}:host(.full-width) .content{flex-grow:1;min-width:0}";

const DsInfo = class {
  constructor(hostRef) {
    index.registerInstance(this, hostRef);
    /**
     * Defines which width the info element takes
     * @value string: max-width
     * @value string: content
     * @important
     */
    this.size = "max-width";
    /**
     * Hide the Infobutton
     * @value true: Infobutton hidden
     * @value false: Infobutton visible
     * @example hidebutton
     */
    this.hidebutton = false;
    /**
     * Manually controls the visiblity of the popup that contains
     * the explaination text.
     * @value false: Popup is not visible.
     * @value true: Popup is visible.
     * @example popupvisible
     */
    this.popupvisible = false;
    this.infoButtonOffsetX = "0px";
    this.infoButtonOffsetY = "0px";
    this.handleModalOpened = () => {
      this.popupvisible = false;
    };
  }
  /**
   * Sets a modal for the info-I
   *
   * Should not be used with the modal-slot. The slotted modal is more important.
   *
   * @example remote-modal
   */
  async setModal(modal) {
    var _a, _b;
    if (this.modal === modal) {
      return;
    }
    (_a = this.modal) === null || _a === void 0 ? void 0 : _a.removeEventListener("modalOpened", this.handleModalOpened);
    this.modal = modal;
    (_b = this.modal) === null || _b === void 0 ? void 0 : _b.addEventListener("modalOpened", this.handleModalOpened);
  }
  windowClicked(e) {
    this.closePopupOnClickOutside(e);
  }
  onWindowKeyDown() {
    var _a;
    if (this.popupvisible) {
      const isActiveElementInLightDom = ((_a = document.activeElement) === null || _a === void 0 ? void 0 : _a.closest("ds-info")) === this.self;
      if (!(isActiveElementInLightDom || miscUtil.isActiveElement(this.self))) {
        this.popupvisible = false;
      }
    }
  }
  componentWillLoad() {
    // TODO: Watch auf hideButton to verifyElementId when hideButton is set to true?
    if (!this.hidebutton) {
      elementIdHandling.verifyElementId(this.self);
    }
    this.contentResizeObserver = new ResizeObserver(() => {
      requestAnimationFrame(() => {
        this.centerContentAndInfo = this.content.offsetHeight <= 28;
        this.computeInfoButtonOffset();
      });
    });
  }
  connectedCallback() {
    this.modalObserver = new slotObserver.SlotObserver(this.self, "ds-modal", async (nodes) => {
      if (nodes.length > 0) {
        await this.setModal(nodes[0]);
      }
    });
  }
  disconnectedCallback() {
    this.modalObserver.disconnect();
    this.contentResizeObserver.disconnect();
  }
  togglePopUp() {
    if (renderUtil.isSlotDefined(this.self, "content")) {
      this.popupvisible = !this.popupvisible;
    }
  }
  closePopupOnClickOutside(e) {
    var _a;
    if (!((_a = this.modal) === null || _a === void 0 ? void 0 : _a.visible) &&
      this.popupvisible &&
      !e.composedPath().includes(this.popup)) {
      this.popupvisible = false;
      e.stopPropagation();
    }
  }
  setContent(ref) {
    var _a, _b;
    if (ref === this.content) {
      this.computeInfoButtonOffset();
      return;
    }
    if (this.content != null) {
      (_a = this.contentResizeObserver) === null || _a === void 0 ? void 0 : _a.unobserve(this.content);
    }
    this.content = ref;
    (_b = this.contentResizeObserver) === null || _b === void 0 ? void 0 : _b.observe(this.content);
  }
  computeInfoButtonOffset() {
    let offsetX, offsetY;
    const contentSlot = this.content
      .firstElementChild;
    const slottedElements = contentSlot === null || contentSlot === void 0 ? void 0 : contentSlot.assignedElements();
    if (slottedElements != null) {
      for (let i = 0; i < slottedElements.length; ++i) {
        const computedStyle = getComputedStyle(slottedElements[i]);
        offsetX = computedStyle.getPropertyValue("--ds-info-button-offset-x");
        offsetY = computedStyle.getPropertyValue("--ds-info-button-offset-y");
        if (offsetX || offsetY) {
          break;
        }
      }
    }
    this.infoButtonOffsetX = offsetX || "0px";
    this.infoButtonOffsetY = offsetY || "0px";
  }
  render() {
    return (index.h(index.Host, { class: {
        "full-width": this.size === "max-width",
        "content-width": this.size === "content",
        "center-content": this.centerContentAndInfo,
      }, style: {
        "--ds-info-button-offset-x": this.infoButtonOffsetX,
        "--ds-info-button-offset-y": this.infoButtonOffsetY,
      } }, index.h("div", { class: "content", ref: (ref) => this.setContent(ref) }, index.h("slot", null)), index.h("div", { class: {
        "info-container": true,
      } }, index.h("button", { id: elementIdHandling.ElementIdGenerator.createId(this.self, "info-icon"), onClick: () => this.togglePopUp(), class: {
        "info-button": true,
        hidden: this.hidebutton,
      } }, index.h("ds-icon", { icon: "info", size: 24 })), index.h("dx-popup", { dstheme: true, ref: (r) => (this.popup = r), arrowposition: "left", show: this.popupvisible, contentwidth: "unconstrained" }, index.h("slot", { name: "content" }))), index.h("slot", { name: "modal" })));
  }
  get self() { return index.getElement(this); }
};
DsInfo.style = dsInfoCss;

exports.ds_info = DsInfo;
