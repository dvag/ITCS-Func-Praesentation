<!DOCTYPE html>
<html dir="ltr" lang="de">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0"
    />
    <title>App</title>

    <script
      type="module"
      src="../build/design-system.esm.js"
    ></script>
    <link rel="stylesheet" href="../design-system-css/design-system.css" />
  </head>
  <body class="no-id-warning">
    <dx-app>
      <dx-header logo="image" appname="Site Navigation Example"></dx-header>
      <dx-container type="page" color="background">
        <dx-spacer mq1="32v"></dx-spacer>
        <dx-text id="title" type="h1" color="black"
          >Site Navigation Example</dx-text
        >
        <dx-spacer mq1="32v"></dx-spacer>
        <dx-site-navigation>
          <dx-site-navigation-menu
            id="menu"
            slot="menu"
            titlestring="Site Navigation Example"
          >
            <dx-button
              id="calc"
              slot="action"
              label="Berechnen"
              stretch
              type="primary-s"
            ></dx-button>
          </dx-site-navigation-menu>

          <div id="page"></div>
        </dx-site-navigation>

        <div style="height: 130vh"></div>
      </dx-container>
    </dx-app>

    <script>
      const data = [
        {
          name: "First item",
          children: ["First section", "Second section", "Third section"],
        },
        {
          name: "Second item",
          children: ["One", "Two", "Three", "Four", "Five", "Six"],
        },
        {
          name: "Third item",
          children: [],
        },
        {
          name: "Item with a long name",
          children: [
            "The cat is a domestic species of a small carnivorous mammal",
            "The dog is a domesticated descendant of the wolf which is characterized by an upturning tail",
            "Rabbits are small mammals in the family Leporidae",
          ],
        },
        {
          name: "Many children",
          children: [
            "One",
            "Two",
            "Three",
            "Four",
            "Five",
            "Six",
            "Seven",
            "Eight",
            "Nine",
            "Ten",
          ],
        },
        {
          name: "Last item",
          children: ["Single child"],
        },
      ];

      document.addEventListener("DOMContentLoaded", () => {
        const menu = document.querySelector("#menu");
        const page = document.querySelector("#page");
        let currentPage = "";

        window.setState = (value, state) =>
          document
            .querySelector(`dx-site-navigation-menu-item[value='${value}']`)
            .setAttribute("state", state);

        function openPage(pageData) {
          page.innerHTML = "";

          if (pageData.children.length === 0) {
            page.innerHTML += `<dx-text>Welcome to page ${pageData.name}!</dx-text><br><br>`;
          }

          if (pageData.name === "Second item") {
            page.innerHTML += `
              <dx-site-navigation-scope value="${pageData.name}">
                <dx-text>
                  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Illum voluptate porro provident aliquam ex impedit enim voluptas earum eveniet eum. Ratione, cupiditate. Facere, placeat tenetur et voluptatum rerum perferendis iste.
                  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Illum voluptate porro provident aliquam ex impedit enim voluptas earum eveniet eum. Ratione, cupiditate. Facere, placeat tenetur et voluptatum rerum perferendis iste.
                  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Illum voluptate porro provident aliquam ex impedit enim voluptas earum eveniet eum. Ratione, cupiditate. Facere, placeat tenetur et voluptatum rerum perferendis iste.
                  </dx-text></dx-site-navigation-scope>
                <dx-spacer mq1="64v"></dx-spacer>`;
          }

          pageData.children.forEach((subSection, index) => {
            const label = subSection;
            page.innerHTML += `
                    <dx-site-navigation-scope value="${
                      pageData.name + "/" + subSection
                    }">
                      <dx-card>
                        <dx-card-header label="${label}"></dx-card-header>
                        <dx-card-content>
                          <dx-text>This is content of ${subSection}</dx-text>
                          <div style="height: ${
                            pageData.name === "Many children"
                              ? 50
                              : label.length * 100
                          }px">
                            <dx-button type="text" icon="schliessen" onclick="setState('${
                              pageData.name + "/" + subSection
                            }', 'none')"></dx-button>
                            <dx-button type="text" icon="state-success" onclick="setState('${
                              pageData.name + "/" + subSection
                            }', 'success')"></dx-button>
                            <dx-button type="text" icon="state-required" onclick="setState('${
                              pageData.name + "/" + subSection
                            }', 'required')"></dx-button>
                            <dx-button type="text" icon="state-error" onclick="setState('${
                              pageData.name + "/" + subSection
                            }', 'error')"></dx-button>
                            </div>
                        </dx-card-content>
                      </dx-card>
                    </dx-site-navigation-scope>

                  ${
                    index < pageData.children.length - 1
                      ? '<dx-spacer mq1="120v"></dx-spacer>'
                      : ""
                  }
        `;
          });
        }

        data.forEach((pageData) => {
          const item = document.createElement("dx-site-navigation-menu-item");
          item.setAttribute("label", pageData.name);
          item.setAttribute("value", pageData.name);
          pageData.children.forEach((subSection) => {
            const subItem = document.createElement(
              "dx-site-navigation-menu-item"
            );
            subItem.setAttribute("label", subSection);
            subItem.setAttribute("value", pageData.name + "/" + subSection);
            item.appendChild(subItem);
          });
          menu.appendChild(item);
        });

        menu.addEventListener("navigate", (e) => {
          const valueLevel1 = e.detail.value.split("/")[0];

          if (currentPage !== valueLevel1) {
            navigateTo(valueLevel1);
          }
        });

        function navigateTo(value) {
          currentPage = value;

          page.innerHTML = `<div style="display: flex; min-height: 200px; justify-content: center; align-items: center;"><dx-spinner size="xlarge" theme="light"></dx-spinner></div>`;
          setTimeout(
            () => openPage(data.find((pageData) => value === pageData.name)),
            200 + Math.random() * 1600
          );
        }

        navigateTo(data[0].name);
      });
    </script>
  </body>
</html>
